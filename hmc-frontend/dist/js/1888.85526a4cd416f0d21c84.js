"use strict";(self.webpackChunkHMC=self.webpackChunkHMC||[]).push([[1888],{62158:(e,t,n)=>{n.r(t),n.d(t,{getClusterList:()=>F,getClusterProductList:()=>T,getInstanceList:()=>B,getParentProductList:()=>K,getProductList:()=>A,getServiceGroupList:()=>U,setCurrentParentCluster:()=>G,setCurrentParentProduct:()=>D,setCurrentProduct:()=>O});var r=n(80040),o=n.n(r),a=n(86),l=n.n(a),i=n(28222),s=n.n(i),u=n(51679),c=n.n(u),d=n(87198),p=n.n(d),m=n(76986),f=n.n(m),v=n(24278),h=n.n(v),_=n(25110),y=n.n(_),g=n(33733),Z=n.n(g),E=n(19389),S=n.n(E),b=n(58309),w=n.n(b),C=n(45360),k=n(43663),P=n(66058),N=n(98396),R=n(36808),L=n(4243),x=n(82193);function I(e,t){var n=void 0!==Z()&&S()(e)||e["@@iterator"];if(!n){if(w()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return M(e,t);var r=h()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return y()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw a}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K=function(e){return function(t){k.t6.getParentProductList({limit:0}).then((function(n){if(0===(n=n.data).code){var r={name:n.data[0],list:n.dsta},a=-1;if(e){for(var l in n.data)n.data[l]===e&&(a=o()(l,10));r.name=a>-1?n.data[a]:n.data[0]}R.set("em_current_parent_product",r.name),t({type:P.kP.GET_PARENT_PROD_LIST,payload:r})}}))}},T=function(){return function(e){k.t6.getClusterProductList({limit:0}).then((function(t){if(0===(t=t.data).code){var n,r,o,a,i,u,d,m=R.get("em_current_parent_product")||"DTinsight",v=R.get("em_current_cluster_id"),h={};if(v){var _,y,g=c()(_=t.data).call(_,(function(e){return+e.clusterId==+v}));if(h=g||t.data[0],!g&&"kubernetes"===(null===(y=h)||void 0===y?void 0:y.clusterType)){var Z=C.Z.loading("正在跳转默认集群...",0);p()(Z,2500),x.Z.setNaviKey("menu_ops_center","sub_menu_service"),window.location.href="/opscenter/service"}}else h=t.data[0];var E,S,b,w=function(e,t,n){if(0===n)return R.set(L.E9.NAMESPACE,""),e||t[0];var r,o=!1;if(l()(r=s()(t)).call(r,(function(n){var r;l()(r=t[n]||[]).call(r,(function(t){o||t!==e||R.get(L.E9.NAMESPACE)||(o=!0,R.set(L.E9.NAMESPACE,n))}))})),o||R.get(L.E9.NAMESPACE))return e;var a=s()(t)[0];return R.set(L.E9.NAMESPACE,a),t[s()(t)[0]][0]}(m,(null===(n=h)||void 0===n?void 0:n.subdomain)||{},null===(r=h)||void 0===r?void 0:r.mode);if(null!==(o=h)&&void 0!==o&&o.clusterId)if(R.set("em_current_cluster_id",(null===(E=h)||void 0===E?void 0:E.clusterId)||-1),R.set("em_current_cluster_type",null===(S=h)||void 0===S?void 0:S.clusterType),R.set("em_current_parent_product",w),"kubernetes"===(null===(b=h)||void 0===b?void 0:b.clusterType)){var k,N=s()(null===(k=h)||void 0===k?void 0:k.subdomain);R.set("em_current_k8s_namespace",N[0])}e({type:P.kP.GET_PARENT_PROD_LIST,payload:f()({},{name:w||"选择产品",list:t.data,cluster:{id:(null===(a=h)||void 0===a?void 0:a.clusterId)||-1,name:(null===(i=h)||void 0===i?void 0:i.clusterName)||"选择集群",type:(null===(u=h)||void 0===u?void 0:u.clusterType)||"hosts",mode:(null===(d=h)||void 0===d?void 0:d.mode)||0}})})}}))}},A=function(){return function(e){N.get("/api/v2/product",{limit:0}).then((function(t){var n=[];if(0===(t=t.data).code){var r,o=I(t.data.list);try{for(o.s();!(r=o.n()).done;){var a=r.value;1===a.is_current_version&&n.push(a)}}catch(e){o.e(e)}finally{o.f()}e({type:P.kP.SET_PRODUCT_LIST,payload:n})}else C.Z.error(t.msg)}))}},O=function(e){return{type:P.kP.SET_CUR_PRODUCT,payload:e}},D=function(e){return{type:P.kP.SET_CUR_PARENT_PROD,payload:e}},U=function(){return function(e){N.get("/api/container/getCluster",{}).then((function(t){for(var n=(t=t.data).result.data||[],r=0,o=n.length;r<o;r++){for(var a=n[r].services,l=[],i=0,s=a.length;i<s;i++){var u=a[i],c=u.name.toLowerCase();"rabbitmq"!==c&&"mysql"!==c&&l.push(u)}n[r].services=l}e({type:P.kP.GET_S_G_LIST,payload:n})}))}},B=function(){return function(e){N.get("/api/container/queryContainer",{pageSize:200}).then((function(t){t=t.data,e({type:P.kP.GET_INSTANCE_LIST,payload:t.result.data})}))}},F=function(e){return function(e){k.t6.getClusterList({type:void 0,"sort-by":"id","sort-dir":"desc",limit:0,start:0}).then((function(t){if(0===(t=t.data).code){var n;e({type:P.kP.GET_PARENT_CLUSTER_LIST,payload:t.data.clusters});var r=t.data.clusters[0],o=R.get("em_current_cluster_id"),a=o&&c()(n=t.data.clusters).call(n,(function(e){return e.id===+o}))||r;e({type:P.kP.SET_CUR_PARENT_CLUSTER,payload:a}),R.set("em_current_cluster_id",a.id),R.set("em_current_cluster_type",a.type)}else C.Z.error(t.msg)}))}},G=function(e){return{type:P.kP.SET_CUR_PARENT_CLUSTER,payload:e}}},4243:(e,t,n)=>{n.d(t,{E9:()=>i,MD:()=>r,OY:()=>a,RI:()=>l,XN:()=>o});var r=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],o=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],a={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},l={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},i={NAMESPACE:"em_current_k8s_namespace"}},71888:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ge});var r={};n.r(r),n.d(r,{getAuthorityRouter:()=>j,saveUserName:()=>$,setRoleAuthorityList:()=>q});var o,a=n(28760),l=n.n(a),i=n(73126),s=n(68420),u=n(27344),c=n(5281),d=n(84441),p=n(3020),m=n(3362),f=n(44845),v=n(76986),h=n.n(v),_=n(39022),y=n.n(_),g=n(58309),Z=n.n(g),E=n(58118),S=n.n(E),b=n(51679),w=n.n(b),C=n(14418),k=n.n(C),P=n(11882),N=n.n(P),R=n(97606),L=n.n(R),x=n(67294),I=n(24300),M=n(29027),K=n(97779),T=n(97183),A=n(45360),O=n(67908),D=n(30258),U=n(71649),B=n(86),F=n.n(B),G=n(43663),H=n(66058),V=n(40174),$=function(e){return function(t){t({type:H._j.SAVE_USER_INFO,payload:e})}},j=function e(t,n,r){return F()(n).call(n,(function(n){r[n.code]&&t.push.apply(t,(0,U.Z)(n.routers)),n.children.length&&e(t,n.children,r)})),t},q=function(){return function(e){G.bS.getRoleCodes().then((function(t){if(0===(t=t.data).code){var n,r={},o=[];Z()(t.data)&&F()(n=t.data).call(n,(function(e){r[e]=!0})),j(o,V.B,r),e({type:H._j.SET_ROLE_AUTHORITY_LIST,payload:{authorityList:r,authorityRouter:o}})}else A.Z.error(t.msg)}))}},z=n(39100),W=n(62158),Y=n(36808),J=n(42152),Q=n(82193),X=n(98396),ee=n(28222),te=n.n(ee),ne=n(80222),re=n.n(ne),oe=n(8446),ae=n.n(oe),le=n(66870),ie=n.n(le),se=n(29747),ue=n.n(se),ce=n(96718),de=n.n(ce),pe=n(96486),me=n(99210);function fe(e,t){var n=te()(e);if(re()){var r=re()(e);t&&(r=k()(r).call(r,(function(t){return ae()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=l()(r,arguments,o)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var he=me.Z.SubMenu,_e=(0,M.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList}}),void 0)(o=function(e){(0,d.Z)(n,e);var t=ve(n);function n(e){var r;return(0,s.Z)(this,n),r=t.call(this,e),(0,f.Z)((0,c.Z)(r),"getMenuList",(function(e){return L()(e).call(e,(function(e){var t=e.icon,n=e.title,o=e.children,a=void 0===o?[]:o,l=e.code,s=e.level;if(!r.props.authorityList[l])return null;var u=x.createElement(x.Fragment,null,"second"===s&&x.createElement("i",{className:"emicon ".concat(t),style:{verticalAlign:"bottom",marginRight:8}}),n);return a.length?x.createElement(he,{key:l,title:u},r.getMenuList(a)):x.createElement(me.Z.Item,(0,i.Z)({key:l},e),u)}))})),(0,f.Z)((0,c.Z)(r),"handleMenuSelected",(function(e){var t,n=r.props.history,o=e.key,a=e.item;null!==(t=a.props)&&void 0!==t&&t.url&&r.setState({selectKeys:o},(function(){var e,t=sessionStorage.getItem("firstLevelNav");Q.Z.setNaviKey(t,o),n.push(null===(e=a.props)||void 0===e?void 0:e.url)}))})),r.state={openKeys:e.defaultOpenKey,selectKeys:[sessionStorage.getItem("siderLevelNav")]},r}return(0,u.Z)(n,[{key:"componentDidUpdate",value:function(e,t){var n=[sessionStorage.getItem("siderLevelNav")];null!=n&&n.length&&!(0,pe.isEqual)(t.selectKeys,n)&&this.setState({selectKeys:n})}},{key:"render",value:function(){var e=this,t=this.props,n=t.menuList,r=t.style,o=this.state,a=o.selectKeys,l=o.openKeys,i=function(e){for(var t=1;t<arguments.length;t++){var n,r,o=null!=arguments[t]?arguments[t]:{};t%2?F()(n=fe(Object(o),!0)).call(n,(function(t){(0,f.Z)(e,t,o[t])})):ie()?ue()(e,ie()(o)):F()(r=fe(Object(o))).call(r,(function(t){de()(e,t,ae()(o,t))}))}return e}({minHeight:"calc(100vh - 40px)",height:"100%"},r);return x.createElement("div",{className:"dt-sidemenu-dark",style:i},x.createElement(me.Z,{mode:"inline",theme:"dark",openKeys:l,onOpenChange:function(t){return e.setState({openKeys:t})},selectedKeys:a,onClick:this.handleMenuSelected,style:{width:200}},this.getMenuList(n)))}}]),n}(x.Component))||o,ye=n(44930),ge=n(30222),Ze=n.n(ge),Ee=n(80403),Se=n(72536),be=n(32969),we=n(31097);function Ce(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=l()(r,arguments,o)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var ke=function(e){(0,d.Z)(n,e);var t=Ce(n);function n(){var e,r;(0,s.Z)(this,n);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return r=t.call.apply(t,y()(e=[this]).call(e,a)),(0,f.Z)((0,c.Z)(r),"state",{tooltipVisible:!1,popupVisible:!1}),(0,f.Z)((0,c.Z)(r),"setOptions",(function(e){var t=[];return Z()(e)&&F()(e).call(e,(function(e){var n=e.subdomain,r=void 0===n?{}:n,o=e.mode,a=e.clusterName,l={value:a,label:a};if(0===o){var i=r.products,s=void 0===i?[]:i;l.children=L()(s).call(s,(function(e){return{value:e,label:e}}))}else{var u;l.children=[],F()(u=te()(r)).call(u,(function(e){var t;l.children.push({value:e,label:e,children:L()(t=r[e]).call(t,(function(e){return{value:e,label:e}}))})}))}t.push(l)})),t})),(0,f.Z)((0,c.Z)(r),"handleSwitchProduct",(function(e){var t=r.props.HeaderStore.parentProducts,n=w()(t).call(t,(function(t){return t.clusterName===e[0]}));0===(null==n?void 0:n.mode)?(r.props.actions.setCurrentParentProduct(e[1]),Y.set("em_current_parent_product",e[1]),Y.set("em_current_k8s_namespace","")):(r.props.actions.setCurrentParentProduct(e[2]),Y.set("em_current_parent_product",e[2]),Y.set("em_current_k8s_namespace",e[1])),Y.set("em_current_cluster_id",n.clusterId),Y.set("em_current_cluster_type",n.clusterType),Q.Z.setNaviKey("menu_ops_center","hosts"===(null==n?void 0:n.type)?"sub_menu_overview":"sub_menu_service"),window.location.href="hosts"===(null==n?void 0:n.type)?"/opscenter/overview":"/opscenter/service"})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){this.props.actions.getClusterProductList()}},{key:"componentWillUnmount",value:function(){this.props.actions.setCurrentParentProduct("")}},{key:"render",value:function(){var e,t,n=this,r=this.props.HeaderStore,o=this.state.popupVisible,a=r.parentProducts,l=void 0===a?[]:a,i=r.cur_parent_product,s=r.cur_parent_cluster,u=this.setOptions(l),c=Y.get("em_current_k8s_namespace"),d=y()(e=y()(t="".concat(s.name,"/")).call(t,c&&"undefined"!==c?"".concat(c,"/"):"")).call(e,i);return x.createElement(be.Z,{popupClassName:"header-cascader-pop",options:u,onChange:this.handleSwitchProduct,onPopupVisibleChange:function(e){return n.setState({popupVisible:e})}},x.createElement(we.Z,{title:d,placement:"bottom",visible:this.state.tooltipVisible,align:{offset:[0,-7]},onVisibleChange:function(e){return n.setState({tooltipVisible:!o&&e})}},x.createElement("span",{className:"c-text-ellipsis header-cascader-title",onClick:function(){return n.setState({tooltipVisible:!1})}},d),x.createElement(O.Z,{type:"down"})))}}]),n}(x.Component),Pe=n(20841),Ne=n(77268);const Re=function(e){var t=e.visible,r=e.onClose;x.useEffect((function(){}),[]);return x.createElement(D.Z,{className:"installGuideModal",title:x.createElement("span",null,"欢迎使用HMC产品部署管家！",x.createElement("span",{style:{color:"#BFBFBF"}},"（V","1.1.0","）")),onCancel:r,visible:t,width:1e3,footer:x.createElement(Ne.Z,{type:"primary",onClick:function(){Q.Z.setNaviKey("menu_deploy_center","sub_menu_product_deploy"),e.history.push("/deploycenter/appmanage/installs"),r()}},"知道了")},x.createElement("div",null,x.createElement("span",null,x.createElement("img",{src:n(86704),style:{width:"976px",height:"auto",display:"block"}}),x.createElement("img",{src:n(82444),style:{width:"976px",height:"auto",display:"block"}})),x.createElement("div",{style:{marginLeft:"28px"}},"若需要对已部署组件进行 “升级” 或 “回滚” 等管理操作，请前往",x.createElement("span",{onClick:function(){Q.Z.setNaviKey("menu_deploy_center","sub_menu_cluster_manage"),e.history.push("/deploycenter/cluster/list"),r()},style:{color:"#3F87FF",cursor:"pointer"}},"部署中心"),"选择集群 → 已部署组件。")))};function Le(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=l()(r,arguments,o)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var xe=n(97008),Ie=me.Z.Item,Me=T.Z.Header;const Ke=function(e){(0,d.Z)(n,e);var t=Le(n);function n(){var e,r;(0,s.Z)(this,n);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return r=t.call.apply(t,y()(e=[this]).call(e,a)),(0,f.Z)((0,c.Z)(r),"state",{selfInfo:{},isCheckedResetPwd:!1,showModal:!1,showInstallGuide:!1}),(0,f.Z)((0,c.Z)(r),"getUserInfo",(function(){G.bS.getLoginedUserInfo().then((function(e){if(0===(e=e.data).code){var t=e.data,n=t.info,o=t.reset_password,a=0===n.reset_password_status&&o;r.setState({selfInfo:e.data.info,isCheckedResetPwd:a,showModal:a}),localStorage.setItem("em_role_id",null==n?void 0:n.role_id)}else A.Z.error(e.msg)}))})),(0,f.Z)((0,c.Z)(r),"initMenuList",(function(e){var t=r.props.authorityList;return L()(e).call(e,(function(e){var n=e.title,r=e.code,o="menu_user_manage"===r;return!t[r]||o||"first"!==e.level||"menu_deploy_guide"===r||"menu_system_configuration"===r?null:x.createElement(Ie,{key:r},n)}))})),(0,f.Z)((0,c.Z)(r),"handleMenuSelected",(function(e){var t,n,o="kubernetes"===(null===(t=r.props.HeaderStore.cur_parent_cluster)||void 0===t?void 0:t.type),a=w()(V.B).call(V.B,(function(t){return t.code===e.key}))||{};if(null!=a&&a.code&&null!=a&&null!==(n=a.children)&&void 0!==n&&n.length){var l,i,s,u=a.children,c=a.code,d=u;o&&"menu_ops_center"===(null==a?void 0:a.code)&&(d=k()(d).call(d,(function(e){return o&&"sub_menu_service"===e.code})));var p=null!==(l=d[0])&&void 0!==l&&null!==(i=l.children)&&void 0!==i&&i.length?null===(s=d[0])||void 0===s?void 0:s.children[0]:d[0];Q.Z.setNaviKey(c,p.code),r.props.history.push(p.url)}else r.setState({showInstallGuide:!0})})),(0,f.Z)((0,c.Z)(r),"handleLogout",(function(){G.bS.logout().then((function(e){if(0===(e=e.data).code){try{Y.remove("em_token"),Y.remove("em_current_cluster_id")}catch(e){window.location.href="login"}window.location.href="login"}else A.Z.error(e.msg),window.location.href="login"}))})),(0,f.Z)((0,c.Z)(r),"downloadInfo",(0,ye.Z)(Ze().mark((function e(){return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.bS.generate({em_version:"1.1.0"});case 2:0==e.sent.data.code&&window.open("/api/v2/common/deployInfo/download","_self");case 5:case"end":return e.stop()}}),e)})))),(0,f.Z)((0,c.Z)(r),"getUserHelp",(function(e){var t=e.item.props.children,n=e.key;if("部署信息下载"==t&&r.downloadInfo(),"/logout"===n)r.handleLogout();else{var o="/usercenter/members"===n?"sub_menu_user_manage":"menu_security_audit";Q.Z.setNaviKey("",o),r.props.history.push(n)}})),(0,f.Z)((0,c.Z)(r),"initUserMenuList",(function(){var e=r.props.authorityList;return x.createElement(me.Z,{onClick:r.getUserHelp},"true"===Y.get("em_admin")&&e.sub_menu_user_manage&&x.createElement(Ie,{key:"/usercenter/members"},"用户管理"),e.menu_deploy_info_markdown_download&&x.createElement(Ie,{key:"/usercenter/members"},"部署信息下载"),e.menu_security_audit&&x.createElement(Ie,{key:"/usercenter/audit"},"安全审计"),x.createElement(Ie,{key:"/logout"},"退出"))})),(0,f.Z)((0,c.Z)(r),"handleResetSubmit",function(){var e=(0,ye.Z)(Ze().mark((function e(t){var n,o,a,l,i;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.bS.getPublicKey();case 2:if(0===(n=e.sent).data.code){e.next=5;break}return e.abrupt("return");case 5:o=n.data.data,a=o.encrypt_type,l=o.encrypt_public_key,i={old_password:"sm2"===a?(0,Se.ON)(t.oldPass,l):(0,Se.g8)(t.oldPass,l),new_password:"sm2"===a?(0,Se.ON)(t.newPass,l):(0,Se.g8)(t.newPass,l)},G.bS.resetPasswordSelf(i).then((function(e){0===(e=e.data).code?(A.Z.success("修改成功"),r.setState({showModal:!1,isCheckedResetPwd:!1})):A.Z.error(e.msg)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,f.Z)((0,c.Z)(r),"resetPwdModalShow",(function(){r.setState({showModal:!r.state.showModal},(function(){r.state.showModal||r.handleLogout()}))})),(0,f.Z)((0,c.Z)(r),"closeInstallGuideShow",(function(){r.setState({showInstallGuide:!1})})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){this.getUserInfo(),"/"===this.props.location.pathname&&this.handleMenuSelected({key:"menu_deploy_center"})}},{key:"render",value:function(){var e=this,t=this.props,n=t.authorityList,r=t.history,o=this.state,a=o.selfInfo,l=o.showModal,i=o.isCheckedResetPwd,s=o.showInstallGuide,u=sessionStorage.getItem("firstLevelNav");return x.createElement(Me,{className:"root-nav"},x.createElement("div",{className:"logo dt-header-log-wrapper"},x.createElement("img",{src:xe}),x.createElement("span",{className:"dt-header-logo-name"},"ChengYing")),x.createElement("div",{className:"nav-container"},x.createElement("div",{className:"header-ops-namespace"},"menu_ops_center"===u&&x.createElement(ke,this.props)),x.createElement(me.Z,{selectedKeys:[u],mode:"horizontal",theme:"dark",onClick:this.handleMenuSelected},this.initMenuList(V.B))),x.createElement("div",{className:"nav-setting"},n.menu_deploy_guide&&x.createElement("a",{className:"em-guide",onClick:function(){return e.handleMenuSelected({key:"menu_deploy_guide"})}},x.createElement("i",{className:"emicon emicon-yunhangbushuxiangdao",style:{verticalAlign:"bottom",marginRight:8}}),"运行部署向导"),"   ",n.menu_system_configuration&&x.createElement("a",{className:"em-guide",onClick:function(){return e.handleMenuSelected({key:"menu_system_configuration"})}},x.createElement(O.Z,{type:"setting",style:{marginRight:8}}),"系统配置"),window.APPCONFIG.userCenter&&x.createElement(Ee.Z,{overlayClassName:"dt-em-dropdown-black root-drop",overlay:this.initUserMenuList(),className:"dropdown"},x.createElement("a",{onClick:function(e){return e.preventDefault()}},(null==a?void 0:a.username)||Y.get("em_username"),x.createElement(O.Z,{style:{marginLeft:1},type:"down"})))),x.createElement(Pe.Z,{visible:l,isCheckedResetPwd:i,onCancel:this.resetPwdModalShow,onSubmit:this.handleResetSubmit}),x.createElement(Re,{onClose:this.closeInstallGuideShow,history:r,visible:s}))}}]),n}(x.Component);var Te,Ae=n(94184),Oe=n.n(Ae);function De(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=l()(r,arguments,o)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var Ue=T.Z.Content,Be=T.Z.Sider,Fe=(0,M.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList,authorityRouter:e.UserCenterStore.authorityRouter,ServiceStore:e.ServiceStore,HeaderStore:e.HeaderStore}}),(function(e){return{actions:(0,K.DE)(h()({},r,z,W),e)}}))(Te=function(e){(0,d.Z)(n,e);var t=De(n);function n(){var e,r;(0,s.Z)(this,n);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return r=t.call.apply(t,y()(e=[this]).call(e,a)),(0,f.Z)((0,c.Z)(r),"state",{lookMoreVisible:!1,tooltipVisible:!1,popupVisible:!1}),(0,f.Z)((0,c.Z)(r),"getRestartService",(function(){X.get("/api/v2/cluster/restartServices",{}).then((function(e){var t,n;0===(e=e.data).code?r.props.actions.setResartServiceList({count:null===(t=e.data)||void 0===t?void 0:t.count,list:null===(n=e.data)||void 0===n?void 0:n.list}):A.Z.error(e.msg)}))})),(0,f.Z)((0,c.Z)(r),"redirectRoute",(function(){var e=r.props.authorityRouter;Z()(e)&&e.length&&!S()(e).call(e,location.pathname)&&r.props.history.push("/nopermission")})),(0,f.Z)((0,c.Z)(r),"getRoleCodes",(function(){r.props.actions.setRoleAuthorityList()})),(0,f.Z)((0,c.Z)(r),"getMenuList",(function(){var e="kubernetes"===Y.get("em_current_cluster_type"),t=r.props.location.pathname.split("/"),n=w()(V.B).call(V.B,(function(e){return e.url==="/".concat(t[1])})),o=(null==n?void 0:n.children)||[];return e&&"menu_ops_center"===(null==n?void 0:n.code)&&(o=k()(o).call(o,(function(t){return e&&"sub_menu_service"===t.code}))),o})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){!Y.get("em_token")&&window.APPCONFIG.userCenter&&(this.props.location.pathname="/login"),this.redirectRoute(),this.getRoleCodes();var e=new J("#J_CopyBtn");e.on("success",(function(e){A.Z.success("复制成功！")})),e.on("error",(function(e){A.Z.error("复制失败！")})),this.getRestartService()}},{key:"componentDidUpdate",value:function(e){var t,n,r=this.props.location;this.props.location.pathname!=e.location.pathname&&this.redirectRoute(),(null==r?void 0:N()(t=r.pathname).call(t,"opscenter"))>-1&&"menu_ops_center"!=sessionStorage.getItem("firstLevelNav")&&Q.Z.setNaviKey("menu_ops_center",sessionStorage.getItem("siderLevelNav")),(null==r?void 0:N()(n=r.pathname).call(n,"deploycenter"))>-1&&"menu_deploy_center"!=sessionStorage.getItem("firstLevelNav")&&Q.Z.setNaviKey("menu_deploy_center",sessionStorage.getItem("siderLevelNav"))}},{key:"componentWillUnmount",value:function(){clearTimeout(void 0)}},{key:"render",value:function(){var e,t,n=this,r=this.props,o=r.ServiceStore,a=r.authorityList,l=r.location,s=r.history,u=r.HeaderStore,c=r.actions,d=this.props.location.pathname,p=o.restartService,m=p.list&&L()(e=p.list).call(e,(function(e,t){return x.createElement("span",{className:"attention-title",key:t},e.depend_product_name,"——",e.depend_service_name,"配置变更后,相关依赖服务",x.createElement("span",{className:"red-attention"},e.product_name,"——",e.service_name),"需要重新“滚动重启”。")}));return x.createElement(T.Z,{className:"root-layout"},x.createElement(Ke,{authorityList:a,location:l,HeaderStore:u,history:s,actions:c}),x.createElement(T.Z,{style:{marginTop:48,position:"fixed",width:"100%"}},"/installguide"!=d&&x.createElement(Be,{className:"dt-layout-sider"},x.createElement(_e,(0,i.Z)({},this.props,{menuList:this.getMenuList(),style:{minHeight:"calc(100vh - 48px)",height:"100%"}}))),x.createElement(Ue,{className:Oe()("root-content",{"has-alert__gobal":p.count>0})},this.props.children)),p.count>0&&x.createElement("div",{className:"root-attention"},x.createElement("div",{className:"service-attention"},x.createElement("div",{className:"attention-content"},x.createElement(O.Z,{type:"exclamation-circle",theme:"filled",style:{color:"#ffa941",marginRight:"8px",marginLeft:"8px"}}),x.createElement("span",{className:"attention-more"},m),p.count>=3&&x.createElement("a",{onClick:function(){n.setState({lookMoreVisible:!0})}},"查看更多")))),x.createElement(D.Z,{visible:this.state.lookMoreVisible,title:"组件变更提示",onCancel:function(){n.setState({lookMoreVisible:!1})},footer:null},x.createElement("ul",null,p.list&&L()(t=p.list).call(t,(function(e,t){return x.createElement("li",{key:t},e.depend_product_name,"——",e.depend_service_name,"配置变更后,相关依赖服务",x.createElement("span",{style:{color:"#ff5f5c"}},e.product_name,"——",e.service_name),"需要重新“滚动重启”。")})))))}}]),n}(x.Component))||Te;const Ge=(0,I.Z)(Fe)},20841:(e,t,n)=>{n.d(t,{Z:()=>C});var r=n(28760),o=n.n(r),a=n(73126),l=n(68420),i=n(27344),s=n(5281),u=n(84441),c=n(3020),d=n(3362),p=n(44845),m=n(39022),f=n.n(m),v=n(67294),h=n(69035),_=n(45360),y=n(30258),g=n(37870),Z=n(4107);function E(e){var t=function(){if("undefined"==typeof Reflect||!o())return!1;if(o().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(o()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var a=(0,d.Z)(this).constructor;n=o()(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var S=h.Z.Item,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},w=function(e){(0,u.Z)(n,e);var t=E(n);function n(){var e,r;(0,l.Z)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return r=t.call.apply(t,f()(e=[this]).call(e,a)),(0,p.Z)((0,s.Z)(r),"validPass",(function(e,t,n){var o=r.props.form;t&&t===o.getFieldValue("oldPass")?n("新密码不能与旧密码一致"):t&&!/^(?![A-z0-9]+$)(?![A-z~!@#$%^&*]+$)(?![0-9~!@#$%^&*]+$)([0-9A-Za-z~!@#$%^&*]{8,20})$/.test(t)&&n("密码须包含数字、字母和特殊字符(支持~!@#$%^&*)，不低于8位"),n()})),(0,p.Z)((0,s.Z)(r),"handleResetSubmit",(function(){r.props.form.validateFields((function(e,t){e||(t.newPass===t.ensurePass?r.props.onSubmit(t):_.Z.error("两次密码填写不一致"))}))})),(0,p.Z)((0,s.Z)(r),"handleCancel",(function(){r.props.onCancel()})),r}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.form,n=e.userInfo,r=e.visible,o=e.isCheckedResetPwd,l=t.getFieldDecorator;return v.createElement(y.Z,{className:"reset-password",maskClosable:!1,destroyOnClose:!0,visible:r,title:"重置密码",onOk:this.handleResetSubmit,onCancel:this.handleCancel},o&&v.createElement(g.Z,{type:"warning",showIcon:!0,message:"管理员开启了初始密码修改，您需要重置初始密码，否则将退出登录影响平台功能使用。"}),v.createElement(h.Z,null,null!=n&&n.username?v.createElement(S,(0,a.Z)({},b,{label:"账号"}),n.username||""):v.createElement(S,(0,a.Z)({},b,{label:"旧密码"}),l("oldPass",{rules:[{required:!0,message:"新密码不能为空"}]})(v.createElement(Z.Z.Password,{placeholder:"请输入旧密码"}))),v.createElement(S,(0,a.Z)({},b,{label:"新密码"}),l("newPass",{rules:[{required:!0,message:"新密码不能为空"},{validator:this.validPass}]})(v.createElement(Z.Z.Password,{placeholder:"请输入新密码"}))),v.createElement(S,(0,a.Z)({},b,{label:"确认新密码"}),l("ensurePass",{rules:[{required:!0,message:"确认新密码不能为空"},{validator:this.validPass}]})(v.createElement(Z.Z.Password,{placeholder:"请再次输入新密码"})))))}}]),n}(v.PureComponent);const C=h.Z.create()(w)},72536:(e,t,n)=>{n.d(t,{ON:()=>i,g8:()=>l});var r=n(49754),o=n(35558),a=n(98130);function l(e,t){if(!t)return e;var n=new r.Z;return n.setPublicKey(t),(0,o.GV)(n.encrypt(e)||"")}function i(e,t){return"04"+a.sg.encrypt(e,t,{inputEncoding:"utf8",outputEncoding:"hex"})}},82193:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(39022),o=n.n(r),a=n(86),l=n.n(a),i=n(11882),s=n.n(i),u=n(97606),c=n.n(u),d=n(28222),p=n.n(d),m=n(2357),f=n.n(m),v=n(45360),h=n(36808),_=n(4243);const y={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,r,a,l;if(!e)return"";var i=new Date(e),s=i.getFullYear(),u=i.getMonth()+1+"",c=i.getDate()+"",d=i.getHours()+"",p=i.getMinutes()+"",m=i.getSeconds()+"";return 1===u.toString().length&&(u="0".concat(u)),1===c.toString().length&&(c="0".concat(c)),1===d.toString().length&&(d="0".concat(d)),1===p.toString().length&&(p="0".concat(p)),1===m.toString().length&&(m="0".concat(m)),o()(t=o()(n=o()(r=o()(a=o()(l="".concat(s,"-")).call(l,u,"-")).call(a,c," ")).call(r,d,":")).call(n,p,":")).call(t,m)},formateDate:function(e){var t,n;if(!e)return"";var r=new Date(e),a=r.getFullYear(),l=r.getMonth()+1+"",i=r.getDate()+"";return 1===l.toString().length&&(l="0".concat(l)),1===i.toString().length&&(i="0".concat(i)),o()(t=o()(n="".concat(a,"-")).call(n,l,"-")).call(t,i)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,r){1001===e.status.code&&(r||v.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return l()(e).call(e,(function(e,n){var r=e.split("-");t[r[1]]=r[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==s()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],r="",o="",a=e.substring(s()(e).call(e,"?")+1,e.length).split("&");for(var l in a)r=(n=a[l].split("="))[0],o=n[1],t[r]=o;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(c()(t=p()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===p()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(v.Z.success(t),n&&n()):v.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(v.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return h.get(_.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return s()(e).call(e,"MB")>-1?f()(e.replace("MB",""))/1024:s()(e).call(e,"KB")>-1?f()(e.replace("KB",""))/1024/1024:s()(e).call(e,"GB")>-1?f()(e.replace("GB","")):s()(e).call(e,"TB")>-1?1024*f()(e.replace("TB","")):0}}},86704:(e,t,n)=>{e.exports=n.p+"images/39068385e9a6f189188c.png"},82444:(e,t,n)=>{e.exports=n.p+"images/a201b6126e0bfb465b4c.png"}}]);