"use strict";(self.webpackChunkHMC=self.webpackChunkHMC||[]).push([[5124],{64158:(e,t,n)=>{n.r(t),n.d(t,{getClusterHostList:()=>_,getClusterhostGroupLists:()=>N,getFilterData:()=>k,getHostInstance:()=>R,getHostList:()=>I,getTableData:()=>L,gethostGroupLists:()=>H,resetHostList:()=>q,setFilterSelectedItem:()=>x,setPager:()=>O,setSearchValue:()=>D,setTableSelectRows:()=>T,showInstallInfo:()=>G,updateHostList:()=>P,updateHostsList:()=>B,updateSelectedHostInfo:()=>K,updateServicesList:()=>M});var r=n(28222),a=n.n(r),o=n(80222),l=n.n(o),s=n(14418),c=n.n(s),i=n(8446),u=n.n(i),d=n(86),p=n.n(d),f=n(66870),h=n.n(f),m=n(29747),v=n.n(m),y=n(96718),g=n.n(y),Z=n(44845),E=n(43663),S=n(66058),C=n(45360);function w(e,t){var n=a()(e);if(l()){var r=l()(e);t&&(r=c()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?p()(n=w(Object(a),!0)).call(n,(function(t){(0,Z.Z)(e,t,a[t])})):h()?v()(e,h()(a)):p()(r=w(Object(a))).call(r,(function(t){g()(e,t,u()(a,t))}))}return e}var x=function(e){return{type:S.uf.HOST_SET_FILTER,payload:e}},k=function(e){return function(t){E.t6.getFilterData(e).then((function(e){t({type:S.uf.HOST_GET_FILTER,payload:e.result.data})}))}},I=function(e,t,n){return function(r){E.t6.getClusterHostList(e,t).then((function(e){0===e.data.code?(r({type:S.uf.UPDATE_HOST_LIST,payload:e.data}),n&&n(e.data.data.hosts)):C.Z.error(e.data.msg)}))}},_=function(e,t){return function(n){var r=e.cluster_type;"hosts"===r&&delete e.role,delete e.cluster_type,E.t6.getClusterHostList(e,r).then((function(e){0===e.data.code?(n({type:S.uf.GET_CLUSTER_HOST_LIST,payload:e.data}),t&&t(e.data.data)):C.Z.error(e.data.msg)}))}},H=function(e,t){return function(n){E.t6.getClusterhostGroupLists(e).then((function(e){0===e.data.code?(n({type:S.uf.GET_HOSTGROUP_LISTS,payload:e.data.data||[]}),e.data.data&&t&&t(e.data.data)):C.Z.error(e.data.msg)}))}},N=function(e){return function(t){E.t6.getClusterhostGroupLists(e).then((function(e){0===e.data.code?t({type:S.uf.GET_CLUSTER_HOSTGROUP_LISTS,payload:e.data.data||[]}):C.Z.error(e.data.msg)}))}},L=function(e){return function(t){E.t6.getTableData(b(b({},e),{},{pageSize:20})).then((function(e){t({type:S.uf.HOST_GET_LIST,payload:e.result})}))}},P=function(e){return{type:S.uf.HOST_GET_LIST,payload:e}},T=function(e){return{type:S.uf.HOST_SET_SELECTED_ROWS,payload:e}},D=function(e){return{type:S.uf.HOST_SET_SEARCH_VALUE,payload:e}},O=function(e){return{type:S.uf.HOST_SET_PAGER,payload:e}},G=function(e){return E.t6.showInstallInfo(e).then((function(e){return e})).catch((function(e){}))},R=function(e){return function(t){E.t6.getHostInstance(e).then((function(e){0===(e=e.data).code&&t({type:S.uf.UPDATE_HOST_INSTANCES_LIST,payload:e.data})}))}},K=function(e,t){return function(n){n({type:S.uf.UPDATE_SELECT_HOST_INFO,payload:{params:e,index:t}})}},M=function(e){return function(t){E.t6.getHostServicesList({pid_list:e.pid_list,ip:e.ip}).then((function(e){var n=[];0===(e=e.data).code?n=e.data:C.Z.error(e.msg),t({type:S.uf.UPDATE_HOST_SERVICES_LIST,payload:n})}))}},B=function(e){return function(t){t({type:S.uf.UPDATE_HOST_LIST,payload:e})}},q=function(){return{type:S.uf.RESET_HOST_LIST,payload:!0}}},87155:(e,t,n)=>{n.d(t,{Z:()=>Q});var r=n(28760),a=n.n(r),o=n(73126),l=n(68420),s=n(27344),c=n(5281),i=n(84441),u=n(3020),d=n(3362),p=n(44845),f=n(39022),h=n.n(f),m=n(67294),v=n(69035),y=n(66253),g=n(44930),Z=n(30222),E=n.n(Z),S=n(76986),C=n.n(S),w=n(87198),b=n.n(w),x=n(11882),k=n.n(x),I=n(97606),_=n.n(I),H=n(9676),N=n(45360),L=n(31097),P=n(67908),T=n(4107),D=n(34041),O=n(77268),G=n(43663),R={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:15}}},K=n(72536);function M(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var B=v.Z.Item,q=y.ZP.Group,A=H.Z.Group,F=function(e){(0,i.Z)(n,e);var t=M(n);function n(){var e,r;(0,l.Z)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r=t.call.apply(t,h()(e=[this]).call(e,o)),(0,p.Z)((0,c.Z)(r),"state",{canGoOn:!1,fileName:"",method:2,testLoading:!1,showErrorHost:!1,canInstallHost:[],installLoading:!1,hostGroups:[],showResultModel:!1,isCreateGroup:!1,addHostData:{},showDetermine:!0,encryptInfo:{}}),(0,p.Z)((0,c.Z)(r),"secretKey",m.createRef()),(0,p.Z)((0,c.Z)(r),"getPublicKey",(0,g.Z)(E().mark((function e(){var t,n;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.bS.getPublicKey();case 2:if(t=e.sent,0===(n=t.data).code){e.next=6;break}return e.abrupt("return");case 6:r.setState({encryptInfo:n.data});case 7:case"end":return e.stop()}}),e)})))),(0,p.Z)((0,c.Z)(r),"loadAllGroups",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e,n=t.type,a=t.id;G.t6.getClusterhostGroupLists({type:n,id:a}).then((function(e){0===(e=e.data).code&&r.setState({hostGroups:e.data||[]})}))})),(0,p.Z)((0,c.Z)(r),"installHost",(function(){var e=r.props,t=e.form,n=e.clusterInfo,a=void 0===n?{}:n,o=r.state.encryptInfo,l=o.encrypt_type,s=o.encrypt_public_key,c=t.getFieldValue("group");t.validateFields((function(e,t){if(!e){var n=r.state.canInstallHost.toString();r.setState({installLoading:!0});var o={host:n,port:t.port,user:t.user,group:t.group,cluster_type:a.type,cluster_id:a.id,role:t.role?t.role.join(","):void 0};1===r.state.method?C()(o,{type:"pk",pk:t.pk}):C()(o,{type:"pwd",password:"sm2"===l?(0,K.ON)(t.password,s):(0,K.g8)(t.password,s)}),G.y$.installHost(o,r.state.method).then((function(e){0!==(e=e.data).code?(N.Z.error(e.msg),r.setState({installLoading:!1})):(b()((function(){r.props.refresh(c)}),1e3),r.props.afterInstall(),r.setState({installLoading:!1}))}))}}))})),(0,p.Z)((0,c.Z)(r),"testConnection",(function(){var e=r.state.encryptInfo,t=e.encrypt_type,n=e.encrypt_public_key;r.setState({showErrorHost:!1}),r.props.form.validateFields((function(e,a){if(!e){var o;a.role=a.role?a.role.join(","):void 0,a.password="sm2"===t?(0,K.ON)(a.password,n):(0,K.g8)(a.password,n),r.setState({testLoading:!0,canGoOn:!1,canInstallHost:[]});var l=(null==a||null===(o=a.host)||void 0===o?void 0:k()(o).call(o,","))>-1?null==a?void 0:a.host.split(","):[a.host];G.y$.testConnection(a,r.state.method).then((function(e){var t=e.data,n=t.code,a=t.data,o=t.msg;if(0!==n)return N.Z.error(o),void r.setState({testLoading:!1});r.setState({testLoading:!1,canInstallHost:l},(function(){var e=a.connectErrorIps,t=a.currentClusterExistIp,n=a.otherClusterExistIp;0===(null==e?void 0:e.length)&&0===(null==t?void 0:t.length)&&0===(null==n?void 0:n.length)?(N.Z.success("测试连通性通过"),r.setState({showDetermine:!1,showResultModel:!1})):r.setState((function(){return{showResultModel:!0,addHostData:a}}))}))}))}}))})),(0,p.Z)((0,c.Z)(r),"handleMethodChange",(function(e){r.setState({method:e.target.value})})),(0,p.Z)((0,c.Z)(r),"uploadSecret",(function(){var e=r.props.form,t=r.secretKey.files[0];if(t)if(t.size/1024>=100)N.Z.warn("请选择小于100Kb文件上传！");else if(window.FileReader){var n=new FileReader;n.readAsText(t),n.onload=function(t){e.setFieldsValue({pk:t.target.result})},r.setState({fileName:t.name}),r.secretKey.value=""}else N.Z.warn("浏览器不支持");else N.Z.warn("请选择上传的秘钥")})),(0,p.Z)((0,c.Z)(r),"handleGroupBlurChange",(function(e){"CREATENEWGROUP"===e&&r.setState({isCreateGroup:!0},(function(){r.props.form.setFieldsValue({group:""})}))})),r}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){this.loadAllGroups(),this.getPublicKey()}},{key:"handleGroupBlur",value:function(e){}},{key:"render",value:function(){var e,t,n,r,a,l,s,c=this,i=this.props.clusterInfo,u=void 0===i?{}:i,d=this.props.form.getFieldDecorator,p=this.state.addHostData;return m.createElement("div",{className:"step-account"},m.createElement(v.Z,{style:{marginBottom:20}},m.createElement(B,(0,o.Z)({style:{marginBottom:20}},R,{label:m.createElement("span",null,"主机分组",m.createElement(L.Z,{title:"主机分组是对主机的划分，当集群中主机过多时，可对主机进行分组，方便管理。"},m.createElement(P.Z,{type:"question-circle"})))}),d("group",{})(this.state.isCreateGroup?m.createElement(T.Z,{placeholder:"输入新的分组名称"}):m.createElement(D.Z,{onChange:this.handleGroupBlurChange,onBlur:this.handleGroupBlur},m.createElement(D.Z.Option,{value:"CREATENEWGROUP"},"新建主机分组"),this.state.hostGroups&&_()(e=this.state.hostGroups).call(e,(function(e,t){return m.createElement(D.Z.Option,{value:e,key:t+""},e)}))))),m.createElement(B,(0,o.Z)({style:{marginBottom:0}},R,{label:"机器IP"}),d("host",{rules:[{required:!0,message:"机器IP不能为空"}]})(m.createElement(T.Z.TextArea,{rows:4,placeholder:"支持输入多个IP及IP段。多个IP用英文都逗号分隔，如172.16.10,171.12.10.9。IP段用英文‘-’连接，如172.16.10-80。"}))),m.createElement(B,(0,o.Z)({style:{marginTop:20}},R,{label:"SSH接口"}),d("port",{rules:[{required:!0,message:"SSH端口不能为空"}],initialValue:"22"})(m.createElement(T.Z,null))),"kubernetes"===u.type&&m.createElement(B,(0,o.Z)({},R,{label:m.createElement(L.Z,{title:m.createElement("div",null,m.createElement("p",null,"主机角色说明："),m.createElement("p",null,"Etcd角色节点：运行etcd组件，用于存储Kubernetes集群配置数据。"),m.createElement("p",null,"Control角色节点：运行Kubernetes主组件（kube-apiserver，kube-scheduler，kube-controller-manager和cloud-controller-manager）。"),m.createElement("p",null,"Worker角色节点：运行Kubernetes kubelet，kube-proxy，Container runtime组件。"))},m.createElement("span",null,"主机角色"),m.createElement(P.Z,{type:"question-circle"}))}),d("role",{rules:[{required:!0,message:"主机角色不能为空"}],initialValue:["Etcd","Control","Worker"]})(m.createElement(A,null,m.createElement(H.Z,{value:"Etcd"},"Etcd"),m.createElement(H.Z,{value:"Control"},"Control"),m.createElement(H.Z,{value:"Worker"},"Worker")))),m.createElement(B,(0,o.Z)({},R,{label:"登录方式"}),m.createElement(q,{value:this.state.method,onChange:this.handleMethodChange},m.createElement(y.ZP,{value:1},"密钥"),m.createElement(y.ZP,{value:2},"密码"))),m.createElement(B,(0,o.Z)({},R,{label:"用户名",extra:"需要sudo+NOPASSWD权限"}),d("user",{rules:[{required:!0,message:"用户名不能为空"}],initialValue:"admin"})(m.createElement(T.Z,null))),2===this.state.method?m.createElement(B,(0,o.Z)({},R,{label:"密码"}),d("password",{rules:[{required:!0,message:"密码不能为空"}]})(m.createElement(T.Z.Password,null))):m.createElement(B,(0,o.Z)({},R,{label:"密钥"}),d("pk",{rules:[{required:!0,message:"密钥不可为空!"}]})(m.createElement(T.Z,{style:{display:"none"}})),m.createElement("label",{className:"ant-btn"},"上传秘钥文件",m.createElement("input",{ref:function(e){return c.secretKey=e},type:"file",onChange:this.uploadSecret,style:{display:"none"}})),m.createElement("span",null,this.state.fileName))),this.state.showResultModel?m.createElement("div",{style:{marginBottom:20}},m.createElement("p",null,m.createElement(P.Z,{type:"close-circle",style:{color:"red",fontSize:14,marginRight:6},theme:"filled"}),"异常IP列表:"),m.createElement("div",{className:"error-desc"},null!=p&&null!==(t=p.connectErrorIps)&&void 0!==t&&t.length?m.createElement("p",null,"- 连通失败IP：",(null==p||null===(n=p.connectErrorIps)||void 0===n?void 0:n.join(","))||"无"):"",null!=p&&null!==(r=p.currentClusterExistIp)&&void 0!==r&&r.length?m.createElement("p",null,"- 以下IP在当前集群已存在：",(null==p||null===(a=p.currentClusterExistIp)||void 0===a?void 0:a.join(","))||"无"):"",null!=p&&null!==(l=p.otherClusterExistIp)&&void 0!==l&&l.length?m.createElement("p",null,"- 以下IP在其他集群已存在：",(null==p||null===(s=p.otherClusterExistIp)||void 0===s?void 0:s.join(","))||"无"):"")):"",m.createElement("div",{className:"btn-container"},m.createElement(O.Z,{loading:this.state.testLoading,type:"primary",onClick:this.testConnection},"测试连通性"),m.createElement("div",null,m.createElement(O.Z,{onClick:this.props.onCancel,type:"default",className:"mr-8"},"取消"),m.createElement(O.Z,{onClick:this.installHost,type:"primary",loading:this.state.installLoading,disabled:this.state.showResultModel||this.state.showDetermine},"确定"))))}}]),n}(m.Component);const U=v.Z.create()(F);function V(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var W=H.Z.Group,j=v.Z.Item,z=function(e){(0,i.Z)(n,e);var t=V(n);function n(){var e,r;(0,l.Z)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r=t.call.apply(t,h()(e=[this]).call(e,o)),(0,p.Z)((0,c.Z)(r),"state",{canGoOn:!1,cmdContent:"",roles:["Etcd","Control","Worker"],formItemMsg:{status:"success",help:""}}),(0,p.Z)((0,c.Z)(r),"fetchInstallCmd",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e,n=t.type,a=t.id;G.jy.getInstallCMD({type:n,clusterId:a,role:r.state.roles.join(",")}).then((function(e){0===e.data.code?r.setState({cmdContent:e.data.data}):N.Z.error(e.data.msg)}))})),(0,p.Z)((0,c.Z)(r),"handleChange",(function(e){r.setState({roles:e},(function(){r.fetchInstallCmd(),r.handleCheck()}))})),(0,p.Z)((0,c.Z)(r),"handleCheck",(function(){var e={status:"error",help:"请选择主机角色"};return r.state.roles.length&&(e.status="success",e.help=""),r.setState({formItemMsg:e}),e.status})),(0,p.Z)((0,c.Z)(r),"handleCopy",(function(){var e=r.props.clusterInfo;if("success"===("kubernetes"===(void 0===e?{}:e).type?r.handleCheck():"success")){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),document.getElementById("J_CopyBtn").dispatchEvent(t)}})),r}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){this.fetchInstallCmd()}},{key:"render",value:function(){var e=this.props.clusterInfo,t=void 0===e?{}:e,n=this.state,r=n.formItemMsg,a=n.roles;return m.createElement("div",{className:"step-shell"},"kubernetes"===t.type&&m.createElement(v.Z,null,m.createElement(j,(0,o.Z)({},R,{required:!0,validateStatus:r.status,help:r.help,label:m.createElement(L.Z,{title:m.createElement("div",null,m.createElement("p",null,"主机角色说明："),m.createElement("p",null,"Etcd角色节点：运行etcd组件，用于存储Kubernetes集群配置数据。"),m.createElement("p",null,"Control角色节点：运行Kubernetes主组件（kube-apiserver，kube-scheduler，kube-controller-manager和cloud-controller-manager）。"),m.createElement("p",null,"Worker角色节点：运行Kubernetes kubelet，kube-proxy，Container runtime组件。"))},m.createElement("span",null,"主机角色"),m.createElement(P.Z,{type:"question-circle"}))}),m.createElement(W,{value:a,onChange:this.handleChange},m.createElement(H.Z,{value:"Etcd"},"Etcd"),m.createElement(H.Z,{value:"Control"},"Control"),m.createElement(H.Z,{value:"Worker"},"Worker")))),m.createElement("div",{className:"clearfix"},m.createElement("div",{className:"ant-col ant-form-item-control-wrapper ant-col-xs-24 ant-col-sm-18 ant-col-offset-3"},m.createElement("p",{style:{fontSize:12,color:"#333",marginBottom:8}},"复制下面命令到命令行执行："),m.createElement(T.Z.TextArea,{id:"J_CMDCode",rows:7,value:this.state.cmdContent}),m.createElement(O.Z,{className:"mt-10 mb-20",onClick:this.handleCopy},"复制代码"),m.createElement(O.Z,{style:{visibility:"hidden"},id:"J_CopyBtn","data-clipboard-action":"cut","data-clipboard-target":"#J_CMDCode"}))),m.createElement("div",{style:{textAlign:"right",marginTop:"28px"}},m.createElement(O.Z,{className:"mr-8",type:"default",onClick:this.props.onCancel},"取消"),m.createElement(O.Z,{type:"primary",onClick:this.props.onCancel},"确定")))}}]),n}(m.Component);function $(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var J=v.Z.Item,Y=y.ZP.Group;const Q=function(e){(0,i.Z)(n,e);var t=$(n);function n(){var e,r;(0,l.Z)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r=t.call.apply(t,h()(e=[this]).call(e,o)),(0,p.Z)((0,c.Z)(r),"state",{radioType:"account"}),(0,p.Z)((0,c.Z)(r),"handleRadioChange",(function(e){r.setState({radioType:e.target.value})})),r}return(0,s.Z)(n,[{key:"render",value:function(){var e=this.state.radioType,t=this.props,n={afterInstall:t.afterInstall,refresh:t.refresh,clusterInfo:t.clusterInfo,onCancel:t.onCancel};return m.createElement("div",{className:"create-host-container"},m.createElement(v.Z,null,m.createElement(J,(0,o.Z)({label:"接入方式"},R),m.createElement(Y,{value:e,onChange:this.handleRadioChange},m.createElement(y.ZP,{value:"account"},"账号接入"),m.createElement(y.ZP,{value:"shell"},"命令行接入")))),"account"===e?m.createElement(U,n):m.createElement(z,n))}}]),n}(m.Component)},19331:(e,t,n)=>{n.d(t,{Z:()=>g});var r=n(28760),a=n.n(r),o=n(68420),l=n(27344),s=n(5281),c=n(84441),i=n(3020),u=n(3362),d=n(44845),p=n(39022),f=n.n(p),h=n(67294),m=n(35949),v=n(45360);function y(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,i.Z)(this,n)}}var g=function(e){(0,c.Z)(n,e);var t=y(n);function n(){var e,r;(0,o.Z)(this,n);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return r=t.call.apply(t,f()(e=[this]).call(e,l)),(0,d.Z)((0,s.Z)(r),"state",{fileContent:"",fileViewShow:!1}),(0,d.Z)((0,s.Z)(r),"ws",void 0),(0,d.Z)((0,s.Z)(r),"handleShowLog",(function(e){e.preventDefault(),r.setState({fileViewShow:!0},(function(){r.websocketLink()}))})),(0,d.Z)((0,s.Z)(r),"websocketLink",(function(){var e=!1,t=r.props.wsUrl;r.ws=new WebSocket(t),r.ws.onmessage=function(e){r.setState({fileContent:e.data})},r.ws.onerror=function(t){e=!0,v.Z.error("实时日志获取失败！")},r.ws.onclose=function(){r.state.fileViewShow&&!e&&r.websocketLink()}})),r}return(0,l.Z)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.fileViewShow,r=t.fileContent;return h.createElement(h.Fragment,null,h.createElement("a",{style:{fontSize:"12px",display:"inline-block",marginTop:"10px"},onClick:this.handleShowLog},"查看完整日志"),n&&h.createElement(m.Z,{title:"日志",serviceData:null,maskClosable:!0,visible:n,content:r,fileGoBottom:!0,loading:!0,onCancel:function(){e.setState({fileViewShow:!1,fileContent:""},(function(){e.ws.close()}))}}))}}]),n}(h.PureComponent)},35949:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(28760),a=n.n(r),o=n(68420),l=n(27344),s=n(5281),c=n(84441),i=n(3020),u=n(3362),d=n(44845),p=n(97606),f=n.n(p),h=n(81607),m=n.n(h),v=n(39022),y=n.n(v),g=n(67294),Z=n(34041),E=n(85733),S=n(30258),C=n(31097),w=n(4107),b=n(67908);function x(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,i.Z)(this,n)}}var k=Z.Z.Option,I=E.Z.TreeNode,_=function(e){(0,c.Z)(n,e);var t=x(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,d.Z)((0,s.Z)(r),"state",{first_logfile:"",second_logfile:"",show_second_select:!1,second_logs:[],log_message:"",lineNum:"200",searchText:"",sourceText:"",query:""}),(0,d.Z)((0,s.Z)(r),"onSearch",(function(e){r.setState({query:e},(function(){r.setLogMessage(r.props.content,!1)}))})),(0,d.Z)((0,s.Z)(r),"setContent",(function(e){var t=r.setQueryKey(e),n=new RegExp(/([\S ]*ERROR[\S ]*)/,"gi");return t.replace(n,'<span style="color: red">$1</span>')})),(0,d.Z)((0,s.Z)(r),"setQueryKey",(function(e){var t=r.state.query;if(""===t)return e;var n=t.toLowerCase(),a=new RegExp("(".concat(n,")"),"gi");return e.replace(a,'<span style="color: #2391F7">$1</span>')})),(0,d.Z)((0,s.Z)(r),"setLogMessage",(function(e,t){var n=r.props.fileGoBottom,a=document.getElementById("textPre");a&&(a.innerHTML=r.setContent(e||""),(void 0===t?n:t)&&document.getElementsByClassName("log-message-box").length>0&&document.getElementsByClassName("log-message-box")[0].scrollTo(0,a.offsetHeight))})),(0,d.Z)((0,s.Z)(r),"renderServiceSelect",(function(){var e=r.props,t=e.serviceData,n=e.onSelectedService;return g.createElement(E.Z,{showSearch:!0,style:{width:200,marginRight:10},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"按服务搜索",allowClear:!0,treeDefaultExpandAll:!0,onChange:n},function(e){var t=[],n=function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];t.push(g.createElement(I,{value:n,title:n,key:n,selectable:!1},r&&f()(r).call(r,(function(e){return g.createElement(I,{isLeaf:!0,value:e.service_name,title:e.service_name_display,key:n+"-"+e.service_name})}))))}};for(var r in e)n(r);return t}(t))})),r}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){this.setLogMessage(this.props.content)}},{key:"componentDidUpdate",value:function(e,t){var n=document.getElementById("textPre");this.props.content===e.content&&this.props.content&&!n.innerHTML&&this.setLogMessage(this.props.content),this.props.content!==e.content&&this.setLogMessage(this.props.content)}},{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,r=e.title,a=e.maskClosable,o=e.onSelectedFile,l=e.fileList,s=e.content,c=e.selectedFile,i=e.serviceData,u=e.loading;return g.createElement(S.Z,{className:"logtail-box",destroyOnClose:!0,title:r,footer:null,width:800,visible:t,maskClosable:a,onCancel:n},g.createElement("div",{className:"logtail-box"},g.createElement("div",{className:"option-bar",style:{display:"flex"}},i&&g.createElement("span",null,this.renderServiceSelect()),l?g.createElement(Z.Z,{allowClear:!0,showSearch:!0,placeholder:"选择文件",value:c,style:{width:200,marginBottom:10,marginRight:10},onChange:o},f()(l).call(l,(function(e,t){var n,r=m()(e).call(e);return g.createElement(k,{key:y()(n="".concat(r,"-")).call(n,t),value:r},g.createElement(C.Z,{title:r},r))}))):null,g.createElement(w.Z.Search,{placeholder:"输入关键词",style:{width:200,marginBottom:10},onSearch:this.onSearch})),g.createElement("div",{className:"log-message-box",style:{height:"400px",paddingTop:"10px",overflowY:"auto",backgroundColor:"#F5F5F5",border:"1px dashed #DDDDDD"}},s?g.createElement("pre",{id:"textPre",style:{paddingLeft:10,height:"auto"}}):null,""===s?g.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"没有记录"):null,null===s?g.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"请选择上方过滤条件"):null,u&&s&&g.createElement(b.Z,{className:"ml-10",type:"loading"}))))}}]),n}(g.Component)},4243:(e,t,n)=>{n.d(t,{E9:()=>s,MD:()=>r,OY:()=>o,RI:()=>l,XN:()=>a});var r=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],a=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],o={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},l={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},s={NAMESPACE:"em_current_k8s_namespace"}},187:(e,t,n)=>{n.d(t,{Y:()=>a,v:()=>r});var r={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:12}}},a={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}}},8386:(e,t,n)=>{n.d(t,{Z:()=>H});var r=n(71649),a=n(95266),o=n(24282),l=n.n(o),s=n(28222),c=n.n(s),i=n(39022),u=n.n(i),d=n(63460),p=n.n(d),f=n(67294),h=n(45360),m=n(77268),v=n(30258),y=n(11382),g=n(14277),Z=n(74981),E=(n(44576),n(68886),n(40049),n(69604)),S=n(30381),C=n.n(S),w=n(36808),b=n(96486),x=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=l()(n=c()(r)).call(n,(function(e,t){var n,a;return u()(n=u()(a="".concat(e)).call(a,t,"=")).call(n,r[t],"&")}),"".concat(e,"?")).replace(/&$/,"");fetch(a).then((function(e){return e.blob()})).then((function(e){var n=p().createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.click(),p().revokeObjectURL(r.href)})).catch((function(e){h.Z.error(e.message)}))},k=function(e){var t=e.title,n=e.visible,r=e.type,a=e.onColse,o=e.execId,l=e.showFooter,s=void 0===l||l,c=f.useRef(null),i=f.useCallback((function(e){var t=e.type,n=e.payload;switch(t){case"log":x("/api/v2/cluster/downLoadShellLog","".concat(o,"-shell.log"),n);break;case"echo":x("/api/v2/cluster/downLoadShellContent","".concat(o,"-content.sh"),n)}}),[]),u="echo"===r?f.createElement(m.Z,{type:"primary",disabled:!o,onClick:b.debounce((function(){return i({type:"echo",payload:{execId:o}})}),200)},"下载完整脚本"):f.createElement(m.Z,{type:"primary",disabled:!o,onClick:b.debounce((function(){i({type:"log",payload:{clusterId:w.get("em_current_cluster_id"),execId:o}})}),200)},"下载完整日志");return f.createElement(v.Z,{className:"code-view-modal",width:"echo"===r?520:1050,title:t,visible:n,footer:s?u:null,onCancel:function(e){c.current&&c.current.wsClose(),a()}},"echo"===r?f.createElement(I,{execId:o}):f.createElement(_,{execId:o,cref:c}))},I=function(e){var t=e.execId,n=f.useState(""),r=(0,a.Z)(n,2),o=r[0],l=r[1];return f.useEffect((function(){t&&function(e){E.Z.showShellContent({execId:e}).then((function(e){var t=e.data,n=t.data,r=t.code,a=t.msg;if(0===r)return l(n);h.Z.error(a)})).catch((function(e){h.Z.error(e.message)}))}(t)}),[t]),f.createElement(Z.ZP,{className:"ace-code-portal",mode:"golang",theme:"kuroir",value:o,readOnly:!0,width:"400px",height:"100%",showGutter:!1})},_=function(e){var t=e.execId,n=e.cref,o=f.useState([]),l=(0,a.Z)(o,2),s=l[0],c=l[1],i=f.useState(!1),d=(0,a.Z)(i,2),p=d[0],h=d[1],m=f.useRef(null);f.useImperativeHandle(n,(function(){return{wsClose:function(){m.current&&m.current.close(),m.current=null}}}));f.useEffect((function(){if(t)try{var e,n;m.current=new WebSocket(u()(e=u()(n="ws://".concat(window.location.hostname,":")).call(n,window.location.port,"/api/v2/cluster/showShellLog?execId=")).call(e,t)),m.current.onmessage=function(e){c((function(t){var n;return u()(n=[]).call(n,(0,r.Z)(t),[{time:"[".concat(C()().format("hh:mm:ss"),"]"),message:e.data}])})),h(!1)},m.current.onopen=function(e){h(!0)},m.current.onerror=function(e){h(!1)},m.current.onclose=function(){h(!1)}}catch(e){h(!1)}}),[t]);return f.createElement(y.Z,{spinning:p},s.length?f.createElement("div",{className:"log-info"},f.createElement("ul",{dangerouslySetInnerHTML:{__html:function(e){var t="";for(var n in e){t+="\n        <li>\n          <pre>".concat(e[n].message,"</pre>\n        </li>\n      ")}return t}(s)}})):f.createElement(g.Z,null))};const H=f.memo(k,(function(e,t){return e.execId===t.execId}))},15124:(e,t,n)=>{n.r(t),n.d(t,{default:()=>He});var r=n(28760),a=n.n(r),o=n(80222),l=n.n(o),s=n(14418),c=n.n(s),i=n(8446),u=n.n(i),d=n(66870),p=n.n(d),f=n(29747),h=n.n(f),m=n(96718),v=n.n(m),y=n(73126),g=n(68420),Z=n(27344),E=n(5281),S=n(84441),C=n(3020),w=n(3362),b=n(44845),x=n(76986),k=n.n(x),I=n(87198),_=n.n(I),H=n(86),N=n.n(H),L=n(24278),P=n.n(L),T=n(58118),D=n.n(T),O=n(39022),G=n.n(O),R=n(28222),K=n.n(R),M=n(97606),B=n.n(M),q=n(51679),A=n.n(q),F=n(58309),U=n.n(F),V=n(67294),W=n(97779),j=n(29027),z=n(43663),$=n(64158),J=n(94184),Y=n.n(J),Q=n(34041),X=n(4107),ee=n(24105),te=n(69035),ne=n(30258),re=n(67908),ae=n(45360),oe=n(55241),le=n(31097),se=n(45334),ce=n(60331),ie=n(77268),ue=n(37870),de=n(8263),pe=n(14277),fe=n(4243),he=n(87155),me=n(19331);function ve(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,w.Z)(e);if(t){var o=(0,w.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,C.Z)(this,n)}}const ye=function(e){(0,S.Z)(n,e);var t=ve(n);function n(){var e,r;(0,g.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,G()(e=[this]).call(e,o)),(0,b.Z)((0,E.Z)(r),"state",{value:r.props.value,editable:!1}),(0,b.Z)((0,E.Z)(r),"handleChange",(function(e){var t=e.target.value;r.setState({value:t})})),(0,b.Z)((0,E.Z)(r),"successClose",(function(){return function(){r.setState({editable:!1})}})),(0,b.Z)((0,E.Z)(r),"check",(function(){var e;r.props.onChange&&(""===(e=r.state.value)?(ae.Z.error("分组名称不可为空！"),0):e.length>20?(ae.Z.error("分组名称不得超过20字符"),0):/^[a-zA-Z0-9_@*#/]+$/.test(e)||(ae.Z.error("分组名称输入有误，请重新输入！"),0))&&r.props.onChange(r.state.value,r.successClose())})),(0,b.Z)((0,E.Z)(r),"close",(function(){r.setState({editable:!1,value:r.props.value})})),(0,b.Z)((0,E.Z)(r),"edit",(function(){r.setState({editable:!0})})),r}return(0,Z.Z)(n,[{key:"render",value:function(){var e=this.state,t=e.value,n=e.editable;return V.createElement("div",{className:"editable-cell"},n?V.createElement("div",{className:"editable-cell-input-wrapper"},V.createElement(X.Z,{value:t,style:{width:"350px",fontSize:"12px"},placeholder:"只支持字母、数字及_ / @ * #特殊字符，不超过20个字符",onChange:this.handleChange,onPressEnter:this.check}),V.createElement(re.Z,{type:"check",className:"editable-cell-icon-check",onClick:this.check}),V.createElement(re.Z,{type:"close",className:"editable-cell-icon-close",onClick:this.close})):this.props.isShowEditIcon?V.createElement("div",{className:"editable-cell-text-wrapper"},t||" ",V.createElement(re.Z,{type:"edit",className:"editable-cell-icon",onClick:this.edit})):null)}}]),n}(V.Component);var ge,Ze=n(187),Ee=n(8386);function Se(e,t){var n=K()(e);if(l()){var r=l()(e);t&&(r=c()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?N()(n=Se(Object(a),!0)).call(n,(function(t){(0,b.Z)(e,t,a[t])})):p()?h()(e,p()(a)):N()(r=Se(Object(a))).call(r,(function(t){v()(e,t,u()(a,t))}))}return e}function we(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,w.Z)(e);if(t){var o=(0,w.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,C.Z)(this,n)}}var be=Q.Z.Option,xe=X.Z.Search,ke=ee.Z.Panel,Ie=te.Z.Item,_e=(0,j.$j)((function(e){return{filterSelectedItem:e.HostStore.filterSelectedItem,filterData:e.HostStore.filterData,selectRows:e.HostStore.selectRows,searchValue:e.HostStore.searchValue,clusterHostList:e.HostStore.clusterHostList,pager:e.HostStore.pager,clusterHostGroupList:e.HostStore.clusterHostGroupList}}),(function(e){return{actions:(0,W.DE)(k()({},$),e)}}))(ge=function(e){(0,S.Z)(n,e);var t=we(n);function n(e){var r;return(0,g.Z)(this,n),r=t.call(this,e),(0,b.Z)((0,E.Z)(r),"state",{addedHost:null,queryParams:{"sort-by":"id","sort-dir":"desc",q_host:"",hostGroupName:"",limit:10,start:0,currentPage:1,is_running:[],status:[],roles:""},aHostDetail:{status:"",status_msg:""},showModal:!1,rootLink:["/deploycenter/cluster/list","/deploycenter/appmanage/products","/installguide","/deploycenter/appmanage/installs"],activeKey:"",selectedRowKeys:[],selectedRows:[],hostMoveModal:!1,isNewGroup:!1,tableLoading:!1,clusterHostList:[],visibleInfo:{visible:!1,title:"日志查看",type:"log",execId:""},total:0}),(0,b.Z)((0,E.Z)(r),"timer",null),(0,b.Z)((0,E.Z)(r),"progressProp",(function(e){var t=r.props.clusterInfo,n=void 0===t?{}:t;switch(e){case 0:return{percent:0,title:"等待安装",color:"host-status-wait-install"};case-1:return{percent:30,status:"exception",title:"管控安装失败",color:"red-dot dot"};case 1:return{percent:30,status:"active",title:"管控安装成功",color:"green-dot dot"};case-2:return{percent:"hosts"===n.type?60:40,status:"exception",title:"script安装失败",color:"red-dot dot"};case 2:return{percent:"hosts"===n.type?60:40,status:"active",title:"script安装成功",color:"green-dot dot"};case-3:return{percent:"hosts"===n.type?100:50,status:"exception",title:"主机初始化失败",color:"red-dot dot"};case 3:return{percent:"hosts"===n.type?100:50,status:"hosts"===n.type?"success":"active",title:"主机初始化成功",color:"green-dot dot"};case-4:return{percent:50,status:"exception",title:"主机下线",color:"red-dot dot"};case-5:return{percent:60,status:"exception",title:"K8S DOCKER初始化失败",color:"red-dot dot"};case 5:return{percent:60,status:"active",title:"K8S DOCKER初始化成功",color:"green-dot dot"};case-6:return{percent:80,status:"exception",title:"K8S NODE初始化失败",color:"red-dot dot"};case 6:return{percent:80,status:"active",title:"K8S NODE初始化成功",color:"green-dot dot"};case-7:return{percent:100,status:"exception",title:"K8S NODE部署失败",color:"red-dot dot"};case 7:return{percent:100,status:"success",title:"K8S NODE部署成功",color:"green-dot dot"};default:return{percent:100,status:"exception"}}})),(0,b.Z)((0,E.Z)(r),"handleSearchByHost",(function(e){var t=r.state.queryParams;r.setState({selectedRowKeys:[],queryParams:k()(t,{q_host:e,start:0,currentPage:1})},(function(){r.getHostGroups(),r.loadData()}))})),(0,b.Z)((0,E.Z)(r),"loadData",(function(){var e=r.props.clusterInfo,t=r.state.queryParams;r.setState({tableLoading:!0});var n=null!=t&&t.is_running.length?null==t?void 0:t.is_running.join(","):"",a=null!=t&&t.status.length?null==t?void 0:t.status.join(","):"";r.props.actions.getClusterHostList({"sort-by":t["sort-by"],"sort-dir":t["sort-dir"],limit:t.limit,start:t.start,host_or_ip:t.q_host,is_running:n,status:a,group:t.hostGroupName,cluster_id:null==e?void 0:e.id,cluster_type:null==e?void 0:e.type,role:"hosts"===(null==e?void 0:e.type)?void 0:t.roles},(function(e){var t=e.hosts,n=e.count;r.setState({clusterHostList:t,total:n,tableLoading:!1},(function(){clearTimeout(r.timer),r.timer=_()((function(){r.loadData(),r.getHostGroups()}),3e3)}))}))})),(0,b.Z)((0,E.Z)(r),"getHostGroups",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e;r.props.actions.getClusterhostGroupLists({type:t.type,id:t.id})})),(0,b.Z)((0,E.Z)(r),"goToAdd",(function(){r.setState({showModal:!0})})),(0,b.Z)((0,E.Z)(r),"afterHostInstall",(function(){r.setState({showModal:!1}),r.loadData()})),(0,b.Z)((0,E.Z)(r),"hostDelete",(function(){var e=r.state.selectedRows,t=[];N()(e).call(e,(function(e){e.is_running||t.push(e.id)}));var n={aid:t};t.length>0?ne.Z.confirm({title:"只可下架agent已停止的主机，确定下架这些主机吗？",content:"主机下架将会将主机上的数据库信息、服务信息清除掉，请谨慎操作！",icon:V.createElement(re.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定",cancelText:"取消",onCancel:function(){},onOk:function(){z.$b.deleteHost(n).then((function(e){var t=e.data;0===t.code?(ae.Z.success("下架成功！"),r.getHostGroups(),r.loadData()):ae.Z.error(t.msg)}))}}):ne.Z.confirm({title:"当前无agent停止的主机，不支持下架",icon:V.createElement(re.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定"})})),(0,b.Z)((0,E.Z)(r),"handleEvent",(function(e){var t=r.state.visibleInfo;r.setState({visibleInfo:Ce(Ce({},t),{},{visible:!t.visible,execId:e?e.exec_id:""})})})),(0,b.Z)((0,E.Z)(r),"initColumns",(function(){var e,t=r.props.clusterInfo,n=r.state.queryParams,a=fe.RI[t.type],o=[{title:"主机IP",dataIndex:"ip",key:"ip",sorter:!0,width:150,fixed:"left"},{title:"主机名称",dataIndex:"hostname",key:"hostname",render:function(e,t){return V.createElement(oe.Z,{content:V.createElement("span",null,"sid:",t.sid)},e)}},{title:"最近心跳时间",dataIndex:"updated",key:"updated",sorter:!0},{title:"主机创建时间",dataIndex:"created",key:"created",sorter:!0},{title:"启动用户",dataIndex:"run_user",key:"run_user",render:function(e){return V.createElement(le.Z,{placement:"right",title:e},e&&e.length>12?P()(e).call(e,0,13)+"...":e)}},{title:"agent状态",dataIndex:"is_running",key:"is_running",width:150,filters:[{text:"运行中",value:"true"},{text:"已停止",value:"false"}],filteredValue:null==n?void 0:n.is_running,filterMultiple:!0,render:function(e){var t=e?"green-dot dot":"red-dot dot";return V.createElement("span",{className:"status-box"},V.createElement("span",{className:t}),V.createElement("span",null,e?"运行中":"已停止"))}},{title:V.createElement("span",null,"初始化状态"," ",V.createElement(le.Z,{title:a.title},V.createElement(re.Z,{type:"info-circle"}))),dataIndex:"errorMsg",key:"errorMsg",filters:a.filters,filteredValue:null==n?void 0:n.status,filterMultiple:!0,render:function(e,t){var n,o=a.finalStatus;return V.createElement("span",null,D()(n=[-3,-2,-1,-4,-5,-6,-7,o]).call(n,t.status)&&V.createElement("span",{className:"status-box"},V.createElement("span",{className:r.progressProp(t.status).color}),V.createElement("span",null,r.progressProp(t.status).title),t.status!==o&&V.createElement(le.Z,{title:t.errorMsg}," ",V.createElement(re.Z,{type:"info-circle"})))||V.createElement(se.Z,(0,y.Z)({className:"status-progress",style:{width:"80%"},format:function(e){var n;return G()(n="".concat(e,"% ")).call(n,t.errorMsg)}},r.progressProp(t.status))))}},{title:"查看",render:function(e,t){return V.createElement("a",{onClick:function(e){return r.handleEvent(t)}},"日志")}}],l=[{title:"主机角色",dataIndex:"roles",width:250,filters:[{text:"Etcd",value:"Etcd"},{text:"Control",value:"Control"},{text:"Worker",value:"Worker"},{text:"全部",value:"all"}],render:function(e,t){var n=K()(t.roles||{});return B()(n).call(n,(function(e){return t.roles[e]&&V.createElement(ce.Z,{className:"c-cluster__tag",key:e},e)}))}}];return"hosts"===t.type?o:G()(e=[]).call(e,o,l)})),(0,b.Z)((0,E.Z)(r),"onCellChange",(function(e){return function(t,n){var a,o=A()(a=r.props.clusterHostGroupList).call(a,(function(t){return t===e}));z.$b.updateGroupName({old:o,new:t}).then((function(e){0===e.data.code?(ae.Z.success("分组名称修改成功"),n(),r.setState({queryParams:k()(r.state.queryParams,{hostGroupName:t}),activeKey:t},(function(){r.getHostGroups(),r.loadData()}))):ae.Z.error(e.data.msg)}))}})),(0,b.Z)((0,E.Z)(r),"tableFooter",(function(e){return V.createElement("div",null,V.createElement(ie.Z,{className:"mr-10",onClick:r.clickMoveHost,icon:"swap"},"移动到"),V.createElement(ie.Z,{type:"danger",className:"btn_dele",onClick:r.hostDelete,icon:"delete"},"下架"))})),(0,b.Z)((0,E.Z)(r),"clickMoveHost",(function(){r.setState({hostMoveModal:!0})})),(0,b.Z)((0,E.Z)(r),"checkGroupName",(function(e){return""===e?(ae.Z.error("分组名称不可为空！"),!1):e.length>20?(ae.Z.error("分组名称不得超过20字符"),!1):!!/^[a-zA-Z0-9_@*#/]+$/.test(e)||(ae.Z.error("分组名称输入有误，请重新输入！"),!1)})),(0,b.Z)((0,E.Z)(r),"confirmMove",(function(){var e=r.state,t=e.selectedRowKeys,n=e.queryParams,a=r.props.form.getFieldValue("name");r.props.form.validateFields((function(e){!e&&r.checkGroupName(a)&&z.$b.confirmMoveHost({aid:t,to_group:a}).then((function(e){0===e.data.code?(ae.Z.success("移动分组成功"),r.props.form.resetFields(),r.setState({hostMoveModal:!1,isNewGroup:!1,activeKey:a,selectedRowKeys:[],queryParams:k()(n,{hostGroupName:a})},(function(){r.getHostGroups(),r.loadData()}))):ae.Z.error(e.data.msg)}))}))})),(0,b.Z)((0,E.Z)(r),"refresh",(function(e){r.setState({queryParams:k()(r.state.queryParams,{hostGroupName:e}),activeKey:e},(function(){r.loadData()}))})),(0,b.Z)((0,E.Z)(r),"handleClickPanel",(function(e){var t=r.state.queryParams;r.setState({selectedRowKeys:[],queryParams:k()(t,{"sort-by":"id","sort-dir":"desc",q_host:"",hostGroupName:e,limit:10,start:0,currentPage:1,is_running:"",status:"",roles:""}),activeKey:e},(function(){r.loadData()}))})),(0,b.Z)((0,E.Z)(r),"onSelectChange",(function(e,t){r.setState({selectedRowKeys:e,selectedRows:t})})),(0,b.Z)((0,E.Z)(r),"onTableChange",(function(e,t,n){var a=r.props.clusterInfo,o=k()(r.state.queryParams,{start:10*(e.current-1),currentPage:e.current});if(n){var l=n.field,s=n.order;switch(l){case"ip":o["sort-by"]="ip",o["sort-dir"]="descend"===s?"desc":"asc";break;case"updated":o["sort-by"]="updated",o["sort-dir"]="descend"===s?"desc":"asc";break;case"created":o["sort-by"]="created",o["sort-dir"]="descend"===s?"desc":"asc"}}K()(t).length&&(o.is_running=t.is_running||[],o.status=t.errorMsg||[],o.roles="hosts"===a.type?void 0:(t.roles||[]).join(",")),r.setState({queryParams:o,selectedRowKeys:[]},(function(){r.loadData()}))})),(0,b.Z)((0,E.Z)(r),"handleChangeGroup",(function(e){var t=r.props.form.setFieldsValue;"NEWGROUP"===e&&r.setState({isNewGroup:!0},(function(){t({name:""})}))})),r}return(0,Z.Z)(n,[{key:"componentDidMount",value:function(){this.loadData(),this.getHostGroups()}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.clusterHostGroupList;if(""===this.state.activeKey&&U()(t)&&t.length){var n=this.props.clusterHostGroupList[0]||"";this.setState({activeKey:n,queryParams:k()(this.state.queryParams,{hostGroupName:n})},(function(){e.loadData(),e.getHostGroups()}))}}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.clusterHostGroupList,a=n.clusterInfo,o=this.state,l=o.selectedRowKeys,s=o.queryParams,c=o.isNewGroup,i=o.clusterHostList,u=o.visibleInfo,d=this.props.form.getFieldDecorator,p=l.length>0,f={selectedRowKeys:l,onChange:this.onSelectChange},h={size:"small",current:s.currentPage,pageSize:10,total:this.state.total};return V.createElement("div",{className:"host-page"},V.createElement("div",{className:"host-option"},V.createElement(xe,{placeholder:"按主机IP或名称搜索",style:{width:264},onSearch:this.handleSearchByHost}),V.createElement(ie.Z,{type:"primary",style:{float:"right"},onClick:this.goToAdd},"添加主机")),p?V.createElement(ue.Z,{type:"info",showIcon:!0,message:"已选择".concat(l.length,"项")}):null,U()(r)&&r.length?V.createElement(V.Fragment,null,V.createElement(ee.Z,{className:"host-collapse",activeKey:this.state.activeKey,accordion:!0,onChange:this.handleClickPanel,style:{borderRadius:"0",marginTop:"8px"}},B()(r).call(r,(function(e){return V.createElement(ke,{style:{borderRadius:"0"},header:V.createElement("div",{onClick:function(e){e.stopPropagation()},className:"panel-table"},V.createElement(de.Z,{rowKey:function(e,t){return t+""},showHeader:!1,className:"select-table",bordered:!1,pagination:!1,dataSource:[{name:e}],columns:[{title:"name",dataIndex:"name",render:function(e,n){return V.createElement(ye,{isShowEditIcon:!0,value:e,onChange:t.onCellChange(e)})}}]})),key:"".concat(e)},V.createElement(de.Z,{rowKey:"id",size:"middle",className:Y()("dt-pagination-lower",{"has-footer":p}),columns:t.initColumns(),dataSource:i,rowSelection:f,onChange:t.onTableChange,pagination:h,footer:p?t.tableFooter:null,loading:t.state.tableLoading}))}))),"kubernetes"===a.type&&V.createElement(me.Z,{wsUrl:G()(e="ws://".concat(window.location.host,"/api/v2/cluster/kubernetes/")).call(e,a.id,"/installLog")})):V.createElement(pe.Z,{style:{marginTop:"10%"}}),V.createElement(ne.Z,{destroyOnClose:!0,visible:this.state.showModal,title:"添加主机",onCancel:function(){t.setState({showModal:!1})},footer:null},V.createElement(he.Z,{afterInstall:this.afterHostInstall,refresh:this.refresh,clusterInfo:a,onCancel:function(){t.setState({showModal:!1})}})),V.createElement(ne.Z,{visible:this.state.hostMoveModal,width:"650px",title:"移动主机至",onCancel:function(){t.props.form.resetFields(),t.setState({hostMoveModal:!1,isNewGroup:!1})},onOk:this.confirmMove},V.createElement(te.Z,null,V.createElement(Ie,(0,y.Z)({},Ze.v,{label:"主机分组"}),d("name",{rules:[{required:!0,message:"请选择或输入主机分组"}]})(c?V.createElement(X.Z,{placeholder:"请输入新建分组名称",style:{minWidth:200}}):V.createElement(Q.Z,{placeholder:"请选择主机分组",style:{minWidth:200},onChange:this.handleChangeGroup},V.createElement(be,{value:"NEWGROUP"},"新建分组"),r&&B()(r).call(r,(function(e){return V.createElement(be,{value:e,key:e},e)}))))))),u.visible&&V.createElement(Ee.Z,(0,y.Z)({},u,{onColse:this.handleEvent})))}}]),n}(V.Component))||ge;const He=te.Z.create()(_e)},72536:(e,t,n)=>{n.d(t,{ON:()=>s,g8:()=>l});var r=n(49754),a=n(35558),o=n(98130);function l(e,t){if(!t)return e;var n=new r.Z;return n.setPublicKey(t),(0,a.GV)(n.encrypt(e)||"")}function s(e,t){return"04"+o.sg.encrypt(e,t,{inputEncoding:"utf8",outputEncoding:"hex"})}}}]);