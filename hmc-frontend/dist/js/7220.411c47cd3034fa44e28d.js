"use strict";(self.webpackChunkHMC=self.webpackChunkHMC||[]).push([[7220],{47220:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ae});var n=a(28760),r=a.n(n),i=a(28222),o=a.n(i),l=a(80222),u=a.n(l),c=a(14418),s=a.n(c),d=a(8446),h=a.n(d),f=a(86),p=a.n(f),m=a(66870),v=a.n(m),g=a(29747),y=a.n(g),Z=a(96718),C=a.n(Z),P=a(68420),S=a(27344),k=a(5281),E=a(84441),b=a(3020),w=a(3362),x=a(44845),L=a(39022),A=a.n(L),O=a(51679),q=a.n(O),T=a(76986),M=a.n(T),N=a(58309),F=a.n(N),I=a(97606),V=a.n(I),B=a(67294),K=a(39903),R=a(34041),j=a(45360),U=a(4107),z=a(43663),D=a(8263),_=a(96486);function H(e,t){var a=o()(e);if(u()){var n=u()(e);t&&(n=s()(n).call(n,(function(t){return h()(e,t).enumerable}))),a.push.apply(a,n)}return a}function G(e){for(var t=1;t<arguments.length;t++){var a,n,r=null!=arguments[t]?arguments[t]:{};t%2?p()(a=H(Object(r),!0)).call(a,(function(t){(0,x.Z)(e,t,r[t])})):v()?y()(e,v()(r)):p()(n=H(Object(r))).call(n,(function(t){C()(e,t,h()(r,t))}))}return e}function J(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var i=(0,w.Z)(this).constructor;a=r()(n,arguments,i)}else a=n.apply(this,arguments);return(0,b.Z)(this,a)}}var Q=function(e){(0,E.Z)(a,e);var t=J(a);function a(){var e,n;(0,P.Z)(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=t.call.apply(t,A()(e=[this]).call(e,i)),(0,x.Z)((0,k.Z)(n),"state",{pageParams:{start:0,limit:10,"sort-by":"create_time","sort-dir":"desc"},auditList:{list:[],count:0},loading:!1}),(0,x.Z)((0,k.Z)(n),"getAuditList",(function(){var e=n.state.pageParams,t=n.props.reqParams;n.setState({loading:!0}),z.Uv.getSafetyAudit(G(G({},t),e)).then((function(e){0===(e=e.data).code?n.setState({auditList:{count:e.data?e.data.count:0,list:e.data?e.data.list:[]}}):j.Z.error(e.msg),n.setState({loading:!1})}))})),(0,x.Z)((0,k.Z)(n),"handleTableChange",(function(e){var t=G(G({},n.state.pageParams),{},{start:(e.current-1)*e.pageSize});n.setState({pageParams:t},n.getAuditList)})),(0,x.Z)((0,k.Z)(n),"initColumns",(function(){return[{title:"时间",dataIndex:"create_time",key:"create_time",render:function(e){return e||"--"}},{title:"操作人",dataIndex:"operator",key:"operator",render:function(e){return e||"--"}},{title:"操作模块",dataIndex:"module",key:"module"},{title:"动作",dataIndex:"operation",key:"operation"},{title:"详细内容",dataIndex:"content",key:"content",width:"25%",render:function(e){return e||"--"}},{title:"来源IP",dataIndex:"ip",key:"ip",render:function(e){return e||"--"}}]})),n}return(0,S.Z)(a,[{key:"componentDidMount",value:function(){this.getAuditList()}},{key:"componentDidUpdate",value:function(e){(0,_.isEqual)(e.reqParams,this.props.reqParams)||this.setState({pageParams:G(G({},this.state.pageParams),{},{start:0})},this.getAuditList)}},{key:"render",value:function(){var e=this.state,t=e.auditList,a=e.pageParams,n=e.loading,r=this.initColumns(),i={size:"small",pageSize:a.limit,total:t.count,current:a.start/a.limit+1,showTotal:function(e){return B.createElement("span",null,"共",B.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",a.limit,"条")}};return B.createElement(D.Z,{rowKey:"id",className:"dt-table-fixed-base",style:{height:"calc(100vh - 135px)"},scroll:{y:!0},loading:n,columns:r,dataSource:t.list,pagination:i,onChange:this.handleTableChange})}}]),a}(B.PureComponent);function W(e,t){var a=o()(e);if(u()){var n=u()(e);t&&(n=s()(n).call(n,(function(t){return h()(e,t).enumerable}))),a.push.apply(a,n)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a,n,r=null!=arguments[t]?arguments[t]:{};t%2?p()(a=W(Object(r),!0)).call(a,(function(t){(0,x.Z)(e,t,r[t])})):v()?y()(e,v()(r)):p()(n=W(Object(r))).call(n,(function(t){C()(e,t,h()(r,t))}))}return e}function Y(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var i=(0,w.Z)(this).constructor;a=r()(n,arguments,i)}else a=n.apply(this,arguments);return(0,b.Z)(this,a)}}var $=K.Z.RangePicker,ee=R.Z.Option,te=[{value:"content",text:"详细内容",searchKey:"content"},{value:"operator",text:"操作人",searchKey:"operator"},{value:"ip",text:"IP",searchKey:"ip"}],ae=function(e){(0,E.Z)(a,e);var t=Y(a);function a(){var e,n;(0,P.Z)(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=t.call.apply(t,A()(e=[this]).call(e,i)),(0,x.Z)((0,k.Z)(n),"state",{moduleList:[],operationList:[],reqParams:{from:void 0,to:void 0,module:void 0,operation:void 0,content:void 0,operator:void 0,ip:void 0},searchType:te[0],searchVal:""}),(0,x.Z)((0,k.Z)(n),"getAuditModuleList",(function(){z.Uv.getAuditModule().then((function(e){0===(e=e.data).code?n.setState({moduleList:e.data?e.data.list:[]}):j.Z.error(e.msg)}))})),(0,x.Z)((0,k.Z)(n),"getAuditOperation",(function(e){e?z.Uv.getAuditOperation({module:e}).then((function(e){0===(e=e.data).code?n.setState({operationList:e.data?e.data.list:[]}):j.Z.error(e.msg)})):n.setState({operationList:[]})})),(0,x.Z)((0,k.Z)(n),"handleTimeRangeChange",(function(e,t){var a={from:e[0]?e[0].startOf("day").unix():void 0,to:e[1]?e[1].endOf("day").unix():void 0};n.onFilterChange(a)})),(0,x.Z)((0,k.Z)(n),"handleOperateModalChange",(function(e){var t={module:e,operation:void 0};n.getAuditOperation(e),n.onFilterChange(t)})),(0,x.Z)((0,k.Z)(n),"handleActionChange",(function(e){n.onFilterChange({operation:e})})),(0,x.Z)((0,k.Z)(n),"handleSearchTypeChange",(function(e){var t=q()(te).call(te,(function(t){return t.value===e}));n.setState({searchType:t,searchVal:void 0,reqParams:M()({},n.state.reqParams,{operator:"",ip:"",content:""})})})),(0,x.Z)((0,k.Z)(n),"handleSearchValChange",(function(e){n.setState({searchVal:e.target.value})})),(0,x.Z)((0,k.Z)(n),"handleSearch",(function(e){var t=n.state.searchType;n.onFilterChange((0,x.Z)({},t.searchKey,e))})),(0,x.Z)((0,k.Z)(n),"onFilterChange",(function(e){var t=X(X({},n.state.reqParams),e);n.setState({reqParams:t})})),n}return(0,S.Z)(a,[{key:"componentDidMount",value:function(){this.getAuditModuleList()}},{key:"render",value:function(){var e=this.state,t=e.reqParams,a=e.operationList,n=e.moduleList,r=e.searchType,i=e.searchVal,o=t.module,l=t.operation;return B.createElement("div",{className:"security-audit-page"},B.createElement("div",{className:"audit-header"},B.createElement($,{className:"dt-form-shadow-bg mr-20",style:{width:300},allowClear:!0,onChange:this.handleTimeRangeChange}),B.createElement("div",{className:"mr-20"},B.createElement("span",null,"操作模块："),B.createElement(R.Z,{className:"dt-form-shadow-bg",style:{width:200},placeholder:"选择操作模块",allowClear:!0,value:o,onChange:this.handleOperateModalChange},F()(n)&&V()(n).call(n,(function(e){return B.createElement(ee,{key:e,value:e},e)})))),B.createElement("div",{className:"mr-20"},B.createElement("span",null,"动作："),B.createElement(R.Z,{className:"dt-form-shadow-bg",style:{width:200},placeholder:"选择动作",allowClear:!0,value:l,onChange:this.handleActionChange},F()(a)&&V()(a).call(a,(function(e){return B.createElement(ee,{key:e,value:e},e)})))),B.createElement(U.Z.Search,{className:"dt-select-search-bar",style:{width:300},placeholder:"按".concat(r.text,"搜索"),value:i,addonBefore:B.createElement(R.Z,{value:r.value,onChange:this.handleSearchTypeChange},V()(te).call(te,(function(e){return B.createElement(ee,{key:e.value,value:e.value},e.text)}))),onChange:this.handleSearchValChange,onSearch:this.handleSearch})),B.createElement(Q,{reqParams:t}))}}]),a}(B.PureComponent)}}]);