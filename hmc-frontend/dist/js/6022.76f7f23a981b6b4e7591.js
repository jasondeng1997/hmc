"use strict";(self.webpackChunkHMC=self.webpackChunkHMC||[]).push([[6022],{80404:(e,t,n)=>{n.r(t),n.d(t,{addIpToConfig:()=>h,cancelDeploy:()=>D,forceStop:()=>x,forceUninstall:()=>R,getCurrentUnDepolyList:()=>O,getDeployList:()=>T,getIsFirstSmooth:()=>c,getServiceIpList:()=>g,getUnDeployLog:()=>U,getUnDepolyList:()=>Z,getUndeploy:()=>I,getUpgradeType:()=>l,handleSetServiceIp:()=>y,modifyConfigConfig:()=>f,modifyInstanceConfig:()=>p,modifyIpConfig:()=>v,modifyServiceConfig:()=>_,modifyServiceInput:()=>d,resetDeployStatus:()=>N,resetServiceConfig:()=>m,returnToStepOne:()=>C,saveForcedUpgrade:()=>s,startProductDeploy:()=>S,startUnDeployService:()=>L,switchUseCloudByProduct:()=>P,updateIpsByService:()=>E,updateProductConfig:()=>u});var a=n(45360),r=n(66058),o=n(43663),i=n(82193),u=function(e){return function(t){o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?t({type:r.Eo.UPDATE_PRD_CONFIG,payload:e.data.list[0]}):a.Z.error(e.msg)}))}},s=function(e){return{type:r.Eo.SAVE_FORCED_UPGRADE,payload:e}},l=function(e){return{type:r.Eo.UPGRADE_TYPE,payload:e}},c=function(e){return{type:r.Eo.GET_FIRST_SMOOTH,payload:e}},d=function(e){return 0===e.type?{type:r.Eo.MODIFY_INSTANCE_CONFIG,payload:e}:{type:r.Eo.MODIFY_CONFIG_CONFIG,payload:e}},p=function(e){return{type:r.Eo.MODIFY_INSTANCE_CONFIG,payload:e}},f=function(e){return{type:r.Eo.MODIFY_CONFIG_CONFIG,payload:e}},_=function(e){return function(t){o.aJ.motifyServiceConfig({productName:e.product_name,serviceName:e.service_name},{field_path:e.field_path,field:e.field}).then((function(n){0===(n=n.data).code?(n.data&&a.Z.warning(n.data),t(u(e))):a.Z.error(n.msg)}))}},m=function(e){var t=e.service_name;return function(n){o.aJ.resetSchemaField({productName:e.product_name,serviceName:e.service_name},{field_path:e.field_path,product_version:e.product_version}).then((function(i){0===(i=i.data).code?o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(i){0===(i=i.data).code?(n({type:r.Eo.UPDATE_PRD_CONFIG,payload:i.data.list[0]}),o.aJ.getIp({productName:e.product_name,serviceName:e.service_name}).then((function(e){0===(e=e.data).code?n({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:t,ips:e.data.ip}}):a.Z.error(e.msg)}))):a.Z.error(i.msg)})):a.Z.error(i.msg)}))}},g=function(e){var t=e.service_name;return function(n){o.aJ.getIp({productName:e.product_name,serviceName:e.service_name}).then((function(e){0===(e=e.data).code?n({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:t,ips:e.data.ip||[]}}):a.Z.error(e.msg)}))}},v=function(e,t,n){return{type:r.Eo.UPDATE_IP_CONFIG,payload:{pindex:e,index:t,ip:n}}},y=function(e){return function(t){o.aJ.setIp({serviceName:e.service_name,productName:e.product_name},{ip:e.ip}).then((function(n){0===(n=n.data).code?(t({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:e.service_name,ips:e.ip?e.ip.split(","):[]}}),t(u(e))):a.Z.error(n.msg)}))}},h=function(e){return{type:r.Eo.ADD_IP_TO_CONFIG,payload:{pindex:e}}},E=function(e,t){return{type:r.Eo.UPDATE_IP_BY_SERVICE,payload:{service:e,ips:t}}},S=function(e,t){return function(n){o.aJ.deploy({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?(n({type:r.Eo.START_PRD_DEPLOY,payload:{deploy_uuid:e.data.deploy_uuid,deploy_status:!0}}),t()):a.Z.error(e.msg)}))}},C=function(){return{type:r.Eo.RETURN_TO_CONFIG}},T=function(e,t){return function(n){o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(i){0===(i=i.data).code?(n({type:r.Eo.UPDATE_DEPLOY_STATUS,payload:i.data.list[0].status}),o.aJ.getDeployList({deployUuid:e.deploy_uuid}).then((function(e){if(0===e.code)return n({type:r.Eo.UPDATE_DEPLOY_LIST,payload:{list:e.data.list,complete:e.data.complete}});a.Z.error(e.msg)})),"deploying"!==i.data.list[0].status&&t(i)):a.Z.error(i.msg)}))}},N=function(){return{type:r.Eo.RESET_DEPLOY_STATUS}},P=function(e){return{type:r.Eo.SWITH_USE_CLOUD,payload:e}},D=function(e){return function(t){o.aJ.cancelDeploy({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?a.Z.success("已停止部署！"):a.Z.error(e.msg)}))}},L=function(e){return function(t){o.aJ.unDeployService({productName:e.product_name,productVersion:e.product_version},{clusterId:e.clusterId,namespace:e.namespace}).then((function(e){var n=e.data;0===n.code?t({type:r.l2.START_UNDEPLOY,payload:{deploy_uuid:n.data.deploy_uuid,autoRefresh:!0}}):a.Z.error(n.msg)}))}},I=function(e){var t=e.deploy_uuid,n=e.autoRefresh,a=e.complete;return{type:r.l2.START_UNDEPLOY,payload:{deploy_uuid:t,autoRefresh:n,complete:a}}},Z=function(e){return function(t){o.aJ.getUnDeployList({deployUuid:e.deployUuid,start:e.start,status:e.status,limit:e.limit}).then((function(e){if(0===e.data.code){var n=e.data.data.count-e.data.data.list&&e.data.data.list.length;t({type:r.l2.UPDATE_UNDEPLOY_LIST,payload:{unDeployList:e.data.data.list||[],complete:e.data.data.complete,start:n,count:e.data.data.count}})}else a.Z.error(e.data.msg)}))}},O=function(e){return function(t){o.aJ.getUnDeployList({deployUuid:e.deployUuid,start:e.start,status:e.status,limit:e.limit}).then((function(e){0===e.data.code?t({type:r.l2.UPDATE_CURRENT_UNDEPLOY_LIST,payload:{unDeployList:e.data.data.list||[],complete:e.data.data.complete,count:e.data.data.count}}):a.Z.error(e.data.msg)}))}},x=function(e,t){return function(n){o.aJ.forceStop(e).then((function(e){i.Z.serviceCallback(e,"强制卸载成功！",t)}))}},R=function(e,t){return function(n){o.aJ.forceUninstall(e).then((function(e){i.Z.serviceCallback(e,"强制卸载成功！",t)}))}},U=function(e){return function(t){o.aJ.getUnDeployLog(e).then((function(e){0===e.code?t({type:r.l2.GET_UNDEPLOY_LOG,payload:{unDeployLog:e.data||""}}):a.Z.error(e.msg)}))}}},62158:(e,t,n)=>{n.r(t),n.d(t,{getClusterList:()=>w,getClusterProductList:()=>k,getInstanceList:()=>K,getParentProductList:()=>A,getProductList:()=>b,getServiceGroupList:()=>F,setCurrentParentCluster:()=>J,setCurrentParentProduct:()=>M,setCurrentProduct:()=>G});var a=n(80040),r=n.n(a),o=n(86),i=n.n(o),u=n(28222),s=n.n(u),l=n(51679),c=n.n(l),d=n(87198),p=n.n(d),f=n(76986),_=n.n(f),m=n(24278),g=n.n(m),v=n(25110),y=n.n(v),h=n(33733),E=n.n(h),S=n(19389),C=n.n(S),T=n(58309),N=n.n(T),P=n(45360),D=n(43663),L=n(66058),I=n(98396),Z=n(36808),O=n(4243),x=n(82193);function R(e,t){var n=void 0!==E()&&C()(e)||e["@@iterator"];if(!n){if(N()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return U(e,t);var a=g()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return y()(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return U(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var A=function(e){return function(t){D.t6.getParentProductList({limit:0}).then((function(n){if(0===(n=n.data).code){var a={name:n.data[0],list:n.dsta},o=-1;if(e){for(var i in n.data)n.data[i]===e&&(o=r()(i,10));a.name=o>-1?n.data[o]:n.data[0]}Z.set("em_current_parent_product",a.name),t({type:L.kP.GET_PARENT_PROD_LIST,payload:a})}}))}},k=function(){return function(e){D.t6.getClusterProductList({limit:0}).then((function(t){if(0===(t=t.data).code){var n,a,r,o,u,l,d,f=Z.get("em_current_parent_product")||"DTinsight",m=Z.get("em_current_cluster_id"),g={};if(m){var v,y,h=c()(v=t.data).call(v,(function(e){return+e.clusterId==+m}));if(g=h||t.data[0],!h&&"kubernetes"===(null===(y=g)||void 0===y?void 0:y.clusterType)){var E=P.Z.loading("正在跳转默认集群...",0);p()(E,2500),x.Z.setNaviKey("menu_ops_center","sub_menu_service"),window.location.href="/opscenter/service"}}else g=t.data[0];var S,C,T,N=function(e,t,n){if(0===n)return Z.set(O.E9.NAMESPACE,""),e||t[0];var a,r=!1;if(i()(a=s()(t)).call(a,(function(n){var a;i()(a=t[n]||[]).call(a,(function(t){r||t!==e||Z.get(O.E9.NAMESPACE)||(r=!0,Z.set(O.E9.NAMESPACE,n))}))})),r||Z.get(O.E9.NAMESPACE))return e;var o=s()(t)[0];return Z.set(O.E9.NAMESPACE,o),t[s()(t)[0]][0]}(f,(null===(n=g)||void 0===n?void 0:n.subdomain)||{},null===(a=g)||void 0===a?void 0:a.mode);if(null!==(r=g)&&void 0!==r&&r.clusterId)if(Z.set("em_current_cluster_id",(null===(S=g)||void 0===S?void 0:S.clusterId)||-1),Z.set("em_current_cluster_type",null===(C=g)||void 0===C?void 0:C.clusterType),Z.set("em_current_parent_product",N),"kubernetes"===(null===(T=g)||void 0===T?void 0:T.clusterType)){var D,I=s()(null===(D=g)||void 0===D?void 0:D.subdomain);Z.set("em_current_k8s_namespace",I[0])}e({type:L.kP.GET_PARENT_PROD_LIST,payload:_()({},{name:N||"选择产品",list:t.data,cluster:{id:(null===(o=g)||void 0===o?void 0:o.clusterId)||-1,name:(null===(u=g)||void 0===u?void 0:u.clusterName)||"选择集群",type:(null===(l=g)||void 0===l?void 0:l.clusterType)||"hosts",mode:(null===(d=g)||void 0===d?void 0:d.mode)||0}})})}}))}},b=function(){return function(e){I.get("/api/v2/product",{limit:0}).then((function(t){var n=[];if(0===(t=t.data).code){var a,r=R(t.data.list);try{for(r.s();!(a=r.n()).done;){var o=a.value;1===o.is_current_version&&n.push(o)}}catch(e){r.e(e)}finally{r.f()}e({type:L.kP.SET_PRODUCT_LIST,payload:n})}else P.Z.error(t.msg)}))}},G=function(e){return{type:L.kP.SET_CUR_PRODUCT,payload:e}},M=function(e){return{type:L.kP.SET_CUR_PARENT_PROD,payload:e}},F=function(){return function(e){I.get("/api/container/getCluster",{}).then((function(t){for(var n=(t=t.data).result.data||[],a=0,r=n.length;a<r;a++){for(var o=n[a].services,i=[],u=0,s=o.length;u<s;u++){var l=o[u],c=l.name.toLowerCase();"rabbitmq"!==c&&"mysql"!==c&&i.push(l)}n[a].services=i}e({type:L.kP.GET_S_G_LIST,payload:n})}))}},K=function(){return function(e){I.get("/api/container/queryContainer",{pageSize:200}).then((function(t){t=t.data,e({type:L.kP.GET_INSTANCE_LIST,payload:t.result.data})}))}},w=function(e){return function(e){D.t6.getClusterList({type:void 0,"sort-by":"id","sort-dir":"desc",limit:0,start:0}).then((function(t){if(0===(t=t.data).code){var n;e({type:L.kP.GET_PARENT_CLUSTER_LIST,payload:t.data.clusters});var a=t.data.clusters[0],r=Z.get("em_current_cluster_id"),o=r&&c()(n=t.data.clusters).call(n,(function(e){return e.id===+r}))||a;e({type:L.kP.SET_CUR_PARENT_CLUSTER,payload:o}),Z.set("em_current_cluster_id",o.id),Z.set("em_current_cluster_type",o.type)}else P.Z.error(t.msg)}))}},J=function(e){return{type:L.kP.SET_CUR_PARENT_CLUSTER,payload:e}}},40448:(e,t,n)=>{n.d(t,{Z:()=>U});var a=n(28760),r=n.n(a),o=n(68420),i=n(27344),u=n(5281),s=n(84441),l=n(3020),c=n(3362),d=n(44845),p=n(11882),f=n.n(p),_=n(80040),m=n.n(_),g=n(86),v=n.n(g),y=n(24278),h=n.n(y),E=n(97606),S=n.n(E),C=n(81607),T=n.n(C),N=n(67294),P=n(34041),D=n(45360),L=n(31097),I=n(4107),Z=n(67908),O=n(98396);function x(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,c.Z)(e);if(t){var o=(0,c.Z)(this).constructor;n=r()(a,arguments,o)}else n=a.apply(this,arguments);return(0,l.Z)(this,n)}}var R=P.Z.Option,U=function(e){(0,s.Z)(n,e);var t=x(n);function n(e){var a;return(0,o.Z)(this,n),a=t.call(this,e),(0,d.Z)((0,u.Z)(a),"state",{first_logfile:"",second_logfile:"",show_second_select:!1,second_logs:[],log_message:"",lineNum:"200",searchText:"",sourceText:""}),(0,d.Z)((0,u.Z)(a),"handleMenu1Click",(function(e){var t=(0,u.Z)(a),n=a.props.serviceid;f()(e).call(e,"*")>-1?O.get("/api/v2/instance/".concat(n,"/log"),{logfile:e.replace(/\s+/g,""),is_match:!1}).then((function(n){var a,r,o;0===(n=n.data).code?t.setState({first_logfile:e,second_logs:null===(a=n)||void 0===a||null===(r=a.data)||void 0===r||null===(o=r.result)||void 0===o?void 0:o.replace(/\s+/g,"").split(","),show_second_select:!0}):D.Z.error(n.msg)})):O.get("/api/v2/instance/".concat(n,"/log"),{logfile:e,is_match:!0}).then((function(n){0===(n=n.data).code?(t.setState({first_logfile:e,show_second_select:!1,sourceText:n.data.result}),a.setLogMessage(n.data.result,!0)):D.Z.error(n.msg)}))})),(0,d.Z)((0,u.Z)(a),"handleMenu2Click",(function(e){var t=(0,u.Z)(a),n=a.props.serviceid;O.get("/api/v2/instance/".concat(n,"/log"),{logfile:e,is_match:!0,tail_num:a.state.lineNum}).then((function(n){0===(n=n.data).code?(t.setState({second_logfile:e,show_second_select:!0,sourceText:n.data.result}),a.setLogMessage(n.data.result)):D.Z.error(n.msg)}))})),(0,d.Z)((0,u.Z)(a),"handleRefreshLogs",(function(){var e=a.props.serviceid,t=a.state.first_logfile;(m()(a.state.lineNum)>1e3||m()(a.state.lineNum)<0)&&D.Z.error("行数只能位于0-1000之间"),a.state.second_logfile&&(t=a.state.second_logfile),O.get("/api/v2/instance/".concat(e,"/log"),{logfile:t,is_match:!0,tail_num:a.state.lineNum}).then((function(e){0===(e=e.data).code?(a.setState({sourceText:e.data.result}),a.setLogMessage(e.data.result,!0)):D.Z.error(e.msg)}))})),(0,d.Z)((0,u.Z)(a),"handleLineNumChange",(function(e){a.setState({lineNum:e.target.value})})),(0,d.Z)((0,u.Z)(a),"handleSearchChange",(function(e){var t=e.toLowerCase();if(a.setState({searchText:e}),""!==e){var n=a.state.sourceText.toLocaleLowerCase().split(t),r=[];v()(n).call(n,(function(e){r.push(e.length)}));var o=[],i=0;v()(r).call(r,(function(t){o.push(i+t),i+=t+e.length}));for(var u="",s="",l=a.state.sourceText,c=0,d=0;d<o.length;d++)s=h()(l).call(l,o[d],o[d]+e.length),s='<span style="color: red">'.concat(s,"</span>"),u+=h()(l).call(l,c,o[d])+s,c=o[d]+e.length;a.setLogMessage(u)}else a.setLogMessage(a.state.sourceText)})),(0,d.Z)((0,u.Z)(a),"setLogMessage",(function(e,t){document.getElementById("textPre").innerHTML=e,t&&document.getElementsByClassName("log-message-box").length>0&&document.getElementsByClassName("log-message-box")[0].scrollTo(0,document.getElementById("textPre").offsetHeight),a.setState({log_message:e})})),a}return(0,i.Z)(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){}},{key:"render",value:function(){var e=this.props.logs,t=this.state,n=t.first_logfile,a=t.second_logfile,r=t.second_logs,o=void 0===r?[]:r;return N.createElement("div",{className:"logtail-box"},N.createElement("div",{className:"option-bar",style:{display:"flex"}},N.createElement(P.Z,{style:{height:26,minWidth:150,marginBottom:10},value:n,onChange:this.handleMenu1Click},S()(e).call(e,(function(e,t){return N.createElement(R,{key:t+"",value:e},N.createElement(L.Z,{key:t+"",title:e},e))}))),N.createElement("div",{style:this.state.show_second_select?{display:"inline-block",marginLeft:8}:{display:"none"}},N.createElement(P.Z,{style:{height:26,minWidth:150,maxWidth:300,marginBottom:10},value:a,onChange:this.handleMenu2Click},S()(o).call(o,(function(e,t){return N.createElement(R,{key:t+"",value:e},N.createElement(L.Z,{key:t+"",title:T()(e).call(e)},T()(e).call(e)))})))),N.createElement(I.Z,{placeholder:"输入日志行数，“0-1000”之间",onPressEnter:this.handleRefreshLogs,style:{height:26,width:230,marginLeft:8,marginBottom:10},onChange:this.handleLineNumChange,addonAfter:N.createElement(Z.Z,{style:{cursor:"pointer"},onClick:this.handleRefreshLogs,type:"reload"})}),N.createElement(I.Z.Search,{placeholder:"输入关键词",style:{height:26,width:179,marginLeft:10,marginBottom:10},onSearch:this.handleSearchChange})),N.createElement("div",{className:"log-message-box",style:{height:"400px",paddingTop:"10px",overflowY:"auto",backgroundColor:"#F5F5F5",border:"1px dashed #DDDDDD"}},N.createElement("span",null,N.createElement("pre",{id:"textPre",style:{paddingLeft:10}}))))}}]),n}(N.Component)},4243:(e,t,n)=>{n.d(t,{E9:()=>u,MD:()=>a,OY:()=>o,RI:()=>i,XN:()=>r});var a=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],r=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],o={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},i={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},u={NAMESPACE:"em_current_k8s_namespace"}}}]);